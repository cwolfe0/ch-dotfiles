/*

Mx.js - Mastering core JavaScript

YUI 3.x is required and must be pre-loaded
http://yuilibrary.com/projects/yui3

*/

var Mx = (function (options) { // initialize Mx namespace as singleton object

    /*--[ INITIALIZATION ]----------------------------------------------------*/

    options = options || {}; // external config settings

    context = options.context || window; // global context

    var buildID = options.buildID || null; // configured build ID#

    var initialized = new Date(); // initialization timestamp

    var settings = (function () { // default config settings

        // YUI-related settings

        options.YUI = options.YUI || {};

        var localCSSModulePathPrefix = options.YUI.localCSSModulePathPrefix || '';
        var localJSModulePathPrefix = options.YUI.localJSModulePathPrefix || '';
        var yui2ModulePathPrefix = options.YUI.yui2ModulePathPrefix || '';
        var yui2JSModuleType = options.YUI.yui2JSModuleType || '';

        function _localCSSModule (module, isStatic) { return localCSSModulePathPrefix + module + (buildID && !isStatic ? '.build' + buildID : '') + '.css'; }
        function _localJSModule (module, isStatic) { return localJSModulePathPrefix + module + (buildID && !isStatic ? '.build' + buildID : '') + '.js'; }
        function _yui2JSModule (module, noType) { return yui2ModulePathPrefix + module + (yui2JSModuleType && !noType ? yui2JSModuleType : '') + '.js'; }

        options.YUI.config = options.YUI.config || {};

        options.YUI.config.modules = options.YUI.config.modules || {

            /**
             *
             * Mx custom modules
             *
             * NOTE:  addition of async:false to work around changes in YUI from 3.3 to 3.5 (asynchronous loading
             * enabled by default as of YUI 3.5.0 ).  Any new modules loaded in the preload need this setting added
             * as of release 19.0 (Uhlenbeck) when YUI was updated from 3.3.X to 3.11
             *
             *
            **/
            'Mx.Ajax' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Ajax/Mx.Ajax'),
                requires: ['io-form', 'io-upload-iframe', 'Mx.Util', 'Mx.Util.Uri', 'Mx.Ui', 'json-parse', 'thirdparty.stacktrace']
            }
            ,
            'Mx.Ajax-test' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Ajax/Mx.Ajax-test'),
                requires: ['Mx.Ajax','test']
            }
            ,
            'Mx.formUtils' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Mx.formUtils'),
                requires: ['node']
            }
            ,
            'Mx.Ui' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Ui/Mx.Ui'),
                requires: ['widget', 'panel']
            }
            ,
            'Mx.MoreInfoPopup' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('MoreInfoPopup/Mx.MoreInfoPopup'),
                requires: ['widget', 'panel', 'Mx.MoreInfoPopup-css']
            }
            ,
            'Mx.CalendarFocus' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('CalendarFocus/Mx.CalendarFocus'),
                requires: ['widget', 'panel', 'Mx.CalendarFocus-css']
            }
            ,
            'Mx.MoreInfoPopup-test' : {
                async: false,
                type: 'js',
                fullpath: _localJSModule('MoreInfoPopup/Mx.MoreInfoPopup-test'),
                requires: ['Mx.MoreInfoPopup', 'test']
            }
            ,
            'Mx.MoreInfoPopup-css' : {
                async: false,
                type: 'css',
                fullpath: _localCSSModule('MoreInfoPopup/Mx.MoreInfoPopup')
            }
            ,
            'Mx.FrameLayout' : {
                async: false,
                name: 'Mx.FrameLayout',
                type: 'js',
                fullpath: _localJSModule('FrameLayout/Mx.FrameLayout'),
                requires: ['widget']
            }
            ,
            'Mx.FrameLayout-test' : {
                async: false,
                name: 'Mx.FrameLayout-test',
                type: 'js',
                fullpath: _localJSModule('FrameLayout/Mx.FrameLayout-test'),
                requires: ['Mx.FrameLayout', 'test']
            }
            ,
            'Mx.Wizard' : {
                async: false,
                name: 'Mx.Wizard',
                type: 'js',
                fullpath: _localJSModule('Wizard/Mx.Wizard'),
                requires: ['Mx.FrameLayout', 'widget']
            }
            ,
            'Mx.Wizard-test' : {
                async: false,
                name: 'Mx.Wizard-test',
                type: 'js',
                fullpath: _localJSModule('Wizard/Mx.Wizard-test'),
                requires: ['Mx.Wizard', 'test']
            }
            ,
            'Mx.Util.Uri' : {
                async: false,
                name: 'Mx.Util.Uri',
                type: 'js',
                fullpath: _localJSModule('Util/Uri/Mx.Util.Uri')
            }
            ,
            'Mx.Util.Uri-test' : {
                async: false,
                name: 'Mx.Util.Uri-test',
                type: 'js',
                fullpath: _localJSModule('Util/Uri/Mx.Util.Uri-test'),
                requires: ['Mx.Util.Uri']
            }
            ,
            'Mx.Util.Flash-css' : {
                async: false,
                name: 'Mx.Util.Flash-css',
                type: 'css',
                fullpath: _localCSSModule('Util/Flash/Mx.Util.Flash')
            }
            ,
            'Mx.Util.Flash' : {
                async: false,
                name: 'Mx.Util.Flash',
                type: 'js',
                fullpath: _localJSModule('Util/Flash/Mx.Util.Flash'),
                requires: ['node', 'thirdparty.swfobject', 'Mx.Util.Flash-css']
            }
            ,
            'Mx.Util.Obj': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Util/Obj/Mx.Util.Obj'),
                requires: ['json-stringify']
            }
            ,
            'Mx.Util.Obj-test': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('Util/Obj/Mx.Util.Obj-test'),
                requires: ['Mx.Util.Obj']
            }
            ,

            // Third-party modules

            'thirdparty.stacktrace': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('thirdparty/stacktrace', true)
            }
            ,
            'thirdparty.strftime': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('thirdparty/strftime', true)
            }
            ,
            'thirdparty.swfobject': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('thirdparty/swfobject/swfobject', true)
            }
            ,
            'thirdparty.gallery-form': {
                async: false,
                type: 'js',
                fullpath: _localJSModule('thirdparty/gallery-form/gallery-form-min', true)
            }
            ,
            // YUI 2.x modules

            'yui2.yde': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('yahoo-dom-event/yahoo-dom-event', true) // minified rollup
            }
            ,
            'yui2.container': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('container/container'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.dragdrop': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('dragdrop/dragdrop'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.animation': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('animation/animation'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.menu': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('menu/menu'),
                requires: ['yui2.container']
            }
            ,
            'yui2.element': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('element/element'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.button': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('button/button'),
                requires: ['yui2.element']
            }
            ,
            'yui2.connection': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('connection/connection'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.datasource': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('datasource/datasource'),
                requires: ['yui2.yde']
            }
            ,
            'yui2.datatable': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('datatable/datatable'),
                requires: ['yui2.yde', 'yui2.datasource', 'yui2.element']
            }
            ,
            'yui2.paginator': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('paginator/paginator'),
                requires: ['yui2.element']
            }
            ,
            'yui2.slider': {
                async: false,
                type: 'js',
                fullpath: _yui2JSModule('slider/slider'),
                requires: ['yui2.yde', 'yui2.dragdrop', 'yui2.animation']
            }

        };

        // return the computed settings object

        return {

            productID: options.productID || '',
            productName: options.productName || '',

            YUI: {
                defaults: options.YUI.config
            }

        };

    })(); //settings

    // initialize standard sub-modules

    var yui = YUI(); // a custom YUI wrapper object (not the "real" YUI here)

    var y = yui.inst().use('yui'); // a default YUI instance w/ all seed modules

    var browser = Browser();

    var msg = Msg();

    var getOverlayManager = function() {
        if (!this.overlayManager) {
            this.overlayManager = new Mx.Util.OverlayManager();
        }
        return this.overlayManager;
    }

    /*--[ INTERFACE ]---------------------------------------------------------*/

    return {
        context             : context, // backreference to outer (global) context

        buildID             : buildID,
        initialized         : initialized,

        productID           : settings.productID,
        productName         : settings.productName,

        yui                 : yui,
        y                   : y,

        browser             : browser,

        msg                 : msg,

        // This returns and/or generates a single OverlayManager for use by
        // anyone who wants to play well with the other overlays on the page.
        getOverlayManager   : getOverlayManager,

        TestSuite           : {}
    };

    /*--[ IMPLEMENTATION ]----------------------------------------------------*/

    /***************************************************************************
    * YUI
    */
    function YUI () {

        // initialization

        // interface

        return {
            isLoaded    : isLoaded,
            inst        : inst
        };

        // implementation

        function isLoaded () { return context.YUI; }

        function inst (config) { // get a YUI instance (if loaded) w/ default config settings (unless overriden in config)
            if (isLoaded()) {
                config = config ? context.YUI().merge(settings.YUI.defaults, config) : settings.YUI.defaults;
                return context.YUI(config);
            }
            else {
                alert('JS framework not loaded - please clear cache and try again.');
            }
        }

    } // end YUI

    /***************************************************************************
    * Browser
    */
    function Browser () {

        // initialization

        // interface

        return new inst();

        // implementation

        function inst () { // returns a simple browser wrapper and sniffer object

            // Detection supports (major versions only):
            // - Apple Safari 1+
            // - Google Chrome 1+
            // - Mozilla Firefox 1+
            // - Microsoft Internet Explorer 4+
            // TODO: keep this updated and tested as new versions are released!
            // TODO: we should come with browser detection scheme that requires less maintenance. See component/checkUnsupportedBrowser.js.

            this.window = context || window;
            this.yuiUA = y ? y.UA : null; // YUI's UA object

            if (typeof(navigator) === 'object') {

                // base properties
                this.ua         = navigator.userAgent;
                this.name       = navigator.appName;
                this.version    = navigator.appVersion;
                this.baseVer    = parseInt(this.version);
                this.fullVer    = parseFloat(this.version);
                this.uaStr      = this.ua.toLowerCase();
                this.nameStr    = this.name.toLowerCase();

                // set platform flags
                this.linux      = (navigator.userAgent.indexOf('Linux') != -1);
                this.mac        = (navigator.userAgent.indexOf('Mac') != -1);
                this.windows    = (navigator.userAgent.indexOf('Windows') != -1);
                this.platform   = this.linux ? 'Linux' :
                                  this.mac ? 'MacOS' :
                                  this.windows ? 'Windows' :
                                  this.yuiUA ? this.yuiUA.os : 'Unknown operating system';

                // set common useragent identifier flags
                this.chrome     = (this.uaStr.indexOf('chrome') != -1);
                this.firefox    = (this.uaStr.indexOf('firefox') != -1);
                this.gecko      = (this.uaStr.indexOf('gecko') != -1);
                this.mozilla    = (this.uaStr.indexOf('mozilla') != -1); // true for almost everything
                this.msie       = (this.uaStr.indexOf('msie') != -1);
                this.safari     = (this.uaStr.indexOf('safari') != -1);
                this.webkit     = (this.uaStr.indexOf('webkit') != -1);

                // set prevailing/targeted browser flags
                this.c  = false;
                this.ff = false;
                this.ie = false;
                this.s  = false;
                var browserString = 'Unknown browser';
                if (this.mozilla && this.chrome && (this.nameStr.indexOf('netscape') != -1)) { // Chrome calls itself Netscape
                    this.c = true;
                    browserString = 'Chrome (unknown version)';
                };
                if (this.mozilla && this.firefox && (this.nameStr.indexOf('netscape') != -1)) { // Firefox calls itself Netscape
                    this.ff = true;
                    browserString = 'Firefox (unknown version)';
                };
                if (this.mozilla && this.msie && (this.nameStr.indexOf('microsoft') != -1)) { // IE calls itself Microsoft Internet Explorer
                    this.ie = true;
                    browserString = 'Internet Explorer (unknown version)';
                };
                if (this.mozilla && this.safari && !this.chrome && (this.nameStr.indexOf('netscape') != -1)) { // Safari calls itself Netscape
                    this.s = true;
                    browserString = 'Safari (unknown version)';
                };

                // get the base webkit version (as a floating-point number) if available
                if (this.webkit && (this.webkitVer = this.uaStr.match(/webkit\/(\d+(\.\d+)?)/))) this.webkitVer = parseFloat(this.webkitVer[1]);

                // set browser version flags
                // NOTE: this methodology becomes invalid at some point on iOS as the user string contains "CriOS/<version>" instead of "Chrome/<version>" and,
                // in any case, browser version numbers are changing too fast for the methodology below to be sustainable.  Consider changing to something else.
                if (this.c && this.uaStr.indexOf('chrome/1.') != -1) { this.c1x = true; browserString = 'Chrome 1.x' } else { this.c1x = false };
                if (this.c && this.uaStr.indexOf('chrome/2.') != -1) { this.c2x = true; browserString = 'Chrome 2.x' } else { this.c2x = false };
                if (this.c && this.uaStr.indexOf('chrome/3.') != -1) { this.c3x = true; browserString = 'Chrome 3.x' } else { this.c3x = false };
                if (this.c && this.uaStr.indexOf('chrome/4.') != -1) { this.c4x = true; browserString = 'Chrome 4.x' } else { this.c4x = false };
                if (this.c && this.uaStr.indexOf('chrome/5.') != -1) { this.c5x = true; browserString = 'Chrome 5.x' } else { this.c5x = false };
                if (this.c && this.uaStr.indexOf('chrome/6.') != -1) { this.c6x = true; browserString = 'Chrome 6.x' } else { this.c6x = false };
                if (this.c && this.uaStr.indexOf('chrome/7.') != -1) { this.c7x = true; browserString = 'Chrome 7.x' } else { this.c7x = false };
                if (this.c && this.uaStr.indexOf('chrome/8.') != -1) { this.c8x = true; browserString = 'Chrome 8.x' } else { this.c8x = false };
                if (this.c && this.uaStr.indexOf('chrome/9.') != -1) { this.c9x = true; browserString = 'Chrome 9.x' } else { this.c9x = false };
                if (this.c && this.uaStr.indexOf('chrome/10.') != -1) { this.c10x = true; browserString = 'Chrome 10.x' } else { this.c10x = false };
                if (this.c && this.uaStr.indexOf('chrome/11.') != -1) { this.c11x = true; browserString = 'Chrome 11.x' } else { this.c11x = false };
                if (this.c && this.uaStr.indexOf('chrome/12.') != -1) { this.c12x = true; browserString = 'Chrome 12.x' } else { this.c12x = false };
                if (this.c && this.uaStr.indexOf('chrome/13.') != -1) { this.c13x = true; browserString = 'Chrome 13.x' } else { this.c13x = false };
                if (this.c && this.uaStr.indexOf('chrome/14.') != -1) { this.c14x = true; browserString = 'Chrome 14.x' } else { this.c14x = false };
                if (this.c && this.uaStr.indexOf('chrome/15.') != -1) { this.c15x = true; browserString = 'Chrome 15.x' } else { this.c15x = false };
                if (this.c && this.uaStr.indexOf('chrome/16.') != -1) { this.c16x = true; browserString = 'Chrome 16.x' } else { this.c16x = false };
                if (this.c && this.uaStr.indexOf('chrome/17.') != -1) { this.c17x = true; browserString = 'Chrome 17.x' } else { this.c17x = false };
                if (this.c && this.uaStr.indexOf('chrome/18.') != -1) { this.c18x = true; browserString = 'Chrome 18.x' } else { this.c18x = false };
                this.c1up   = (this.c && (this.baseVer >= 5));
                this.c2up   = (this.c1up && !this.c1x);
                this.c3up   = (this.c2up && !this.c2x);
                this.c4up   = (this.c3up && !this.c3x);
                this.c5up   = (this.c4up && !this.c4x);
                this.c6up   = (this.c5up && !this.c5x);
                this.c7up   = (this.c6up && !this.c6x);
                this.c8up   = (this.c7up && !this.c7x);
                this.c9up   = (this.c8up && !this.c8x);
                this.c10up  = (this.c9up && !this.c9x);
                this.c11up  = (this.c10up && !this.c10x);
                this.c12up  = (this.c11up && !this.c11x);
                this.c13up  = (this.c12up && !this.c12x);
                this.c14up  = (this.c13up && !this.c13x);
                this.c15up  = (this.c14up && !this.c14x);
                this.c16up  = (this.c15up && !this.c15x);
                this.c17up  = (this.c16up && !this.c16x);
                this.c18up  = (this.c17up && !this.c17x);
                if (this.ff && this.uaStr.indexOf('firefox/1.') != -1) { this.ff1x = true; browserString = 'Firefox 1.x' } else { this.ff1x = false };
                if (this.ff && this.uaStr.indexOf('firefox/2.') != -1) { this.ff2x = true; browserString = 'Firefox 2.x' } else { this.ff2x = false };
                if (this.ff && this.uaStr.indexOf('firefox/3.') != -1) { this.ff3x = true; browserString = 'Firefox 3.x' } else { this.ff3x = false };
                if (this.ff && this.uaStr.indexOf('firefox/4.') != -1) { this.ff4x = true; browserString = 'Firefox 4.x' } else { this.ff4x = false };
                this.ff1up  = (this.ff && (this.baseVer >= 5));
                this.ff2up  = (this.ff1up && !this.ff1x);
                this.ff3up  = (this.ff2up && !this.ff2x);
                this.ff4up  = (this.ff3up && !this.ff3x);
                if (this.ie && this.uaStr.indexOf('msie 4.') != -1) { this.ie4x = true; browserString = 'Internet Explorer 4.x' } else { this.ie4x = false };
                if (this.ie && this.uaStr.indexOf('msie 5.') != -1) { this.ie5x = true; browserString = 'Internet Explorer 5.x' } else { this.ie5x = false };
                if (this.ie && this.uaStr.indexOf('msie 6.') != -1) { this.ie6x = true; browserString = 'Internet Explorer 6.x' } else { this.ie6x = false };
                if (this.ie && this.uaStr.indexOf('msie 7.') != -1) { this.ie7x = true; browserString = 'Internet Explorer 7.x' } else { this.ie7x = false };
                if (this.ie && this.uaStr.indexOf('msie 8.') != -1) { this.ie8x = true; browserString = 'Internet Explorer 8.x' } else { this.ie8x = false };
                if (this.ie && this.uaStr.indexOf('msie 9.') != -1) { this.ie9x = true; browserString = 'Internet Explorer 9.x' } else { this.ie9x = false };
                this.ie4up  = (this.ie && (this.baseVer >= 4));
                this.ie5up  = (this.ie4up && !this.ie4x);
                this.ie6up  = (this.ie5up && !this.ie5x);
                this.ie7up  = (this.ie6up && !this.ie6x);
                this.ie8up  = (this.ie7up && !this.ie7x);
                this.ie9up  = (this.ie8up && !this.ie8x);
                if (this.s && this.webkitVer && this.webkitVer < 400) { this.s1x = true; browserString = 'Safari 1.x' } else { this.s1x = false }; // no simple version info (until 3.x)
                if (this.s && this.webkitVer && this.webkitVer >= 400 && this.webkitVer < 500) { this.s2x = true; browserString = 'Safari 2.x' } else { this.s2x = false };
                if (this.s && this.webkitVer && this.webkitVer >= 500 && this.uaStr.indexOf('version/3.') != -1) { this.s3x = true; browserString = 'Safari 3.x' } else { this.s3x = false };
                if (this.s && this.webkitVer && this.webkitVer >= 525 && this.uaStr.indexOf('version/4.') != -1) { this.s4x = true; browserString = 'Safari 4.x' } else { this.s4x = false };
                if (this.s && this.webkitVer && this.webkitVer >= 533 && this.uaStr.indexOf('version/5.') != -1) { this.s5x = true; browserString = 'Safari 5.x' } else { this.s5x = false };
                this.s1up   = (this.s && this.webkitVer && this.webkitVer > 0);
                this.s2up   = (this.s1up && !this.s1x);
                this.s3up   = (this.s2up && !this.s2x);
                this.s4up   = (this.s3up && !this.s3x);
                this.s5up   = (this.s4up && !this.s4x);

                this.browserString = browserString;
            }

            this.setStatus = function (message) { // update the window status bar
                this.window.status = message || '';
                return true;
            };

            this.popup = function (url, name, width, height, features) { // open a popup window
                if (!url) url = 'about:blank';
                if (!name) name = 'popup';
                if (!width) width = 640;
                if (!height) height = 480;
                if (!features) features = 'directories=no,location=no,menubar=no,resizable=no,scrollbars=no,status=no,toolbar=no';
                features = 'width=' + width + ',height=' + height + ',' + features;
                var window_handle = '';
                window_handle = this.window.open(url, name, features);
                return window_handle;
            };

            this.killPopup = function (name) { // kill popup by name
                var wh = this.window.open('', name);
                if (typeof wh != 'undefined' && wh ) {
                    wh.close();
                }
                this.window.focus();
            };

            this.toString = function () { return this.ua }; // override stringification

        };

    } // end Browser

    /***************************************************************************
    * Msg
    */
    function Msg () {

        // initialization

        var msgs = {};

        // interface

        return {
            set : set,
            get : get
        };

        // implementation

        function set (k, v) {
            if (!k || !y.Lang.isValue(v)) return;
            return y.Lang.isValue(msgs[k] = v);
        }

        function get (k) {
            if (!k || !y.Lang.isValue(msgs[k])) return;
            return (y.Lang.isFunction(msgs[k]) ? msgs[k].apply(null, Array.prototype.slice.call(arguments, 1)) : msgs[k]);

        }

    } // end Msg

})(
(typeof(MxConf) == 'object' ? MxConf : null)
); // end Mx

/******************************************************************************/

//
// Mx.Util inline module definition
//
Mx.y.add('Mx.Util', function(Y) {

    if (Mx.Util) {
        return;
    }

    function copyTree (node) {
        if (node == null || typeof(node) != 'object') return node;
        var temp = new node.constructor()
          , key;
        for (key in node) temp[key] = copyTree(node[key]);
        return temp;
    }

    var Util = {

        isUndefined : Y.Lang.isUndefined,
        isBoolean   : Y.Lang.isBoolean,
        isNumber    : Y.Lang.isNumber,
        isString    : Y.Lang.isString,
        isFunction  : Y.Lang.isFunction,
        isObject    : Y.Lang.isObject,
        isArray     : Y.Lang.isArray,
        isValue     : Y.Lang.isValue,
        type        : Y.Lang.type,
        trim        : Y.Lang.trim,

        trunc: function(s, maxLength, useEllipsis, includeEllipsisInCount) {
            if (!s || !Y.Lang.isValue(maxLength)) return s;
            var truncateToLength = includeEllipsisInCount ? maxLength-3 : maxLength;
            if (String(s).length > maxLength) s = (useEllipsis && maxLength > 3) ? String(s).substr(0, truncateToLength) + '...' : String(s).substr(0, maxLength);
            return s;
        }
        ,
        truncWithTrail: function(s, maxLength) {
            if (!s || !Y.Lang.isValue(maxLength)) return s;
            s = Mx.Util.trim(s);
            var strLength = String(s).length;
            if (strLength > maxLength) {
                var trailingLetters = Mx.Util.trim(String(s).substr(strLength-2, strLength));
                s = (maxLength > 5) ? String(s).substr(0, maxLength-4) + '..' + trailingLetters : String(s).substr(0, maxLength);
            }
            return s;
        }
        ,
        round: function(n, powerOf10) {
            if (!n) return n;
            if (!powerOf10) powerOf10 = 0;
            return Math.round(Number(n) * Math.pow(10, powerOf10)) / Math.pow(10, powerOf10);
        }
        ,
        urlEncode: function(s) {
            return escape(s).replace(/\+/g,'%2B').replace(/\"/g,'%22').replace(/\'/g,'%27').replace(/\//g,'%2F');
        }
        ,
        escapeHTML: function(s) {
            return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
        }
        ,
        encode_utf8: function(s) {
            return unescape( encodeURIComponent(s) );
        }
        ,
        decode_utf8: function(s) {
            return decodeURIComponent( escape(s) );
        }
        ,
        imageUri: function (img) { return MxConf.assetsPathUIImg + '/' + img; }
        ,
        //
        // parseDateArray converts our custom date array into a JS date object
        //
        parseDateArray: function(date_array) {
            // Converts our custom date array into a JS date object
            if (date_array == 0) return date_array;
            var date = new Date();
            date.setFullYear(date_array[0]);
            date.setMonth(date_array[1] - 1,date_array[2]);
            date.setHours(date_array[3]);
            date.setMinutes(date_array[4]);
            date.setSeconds(date_array[5]);
            date.setMilliseconds(0);
            return date;
        }
        ,
        adjustDays: function(date_str, day_adjustment) {
            // Creates a Date object with the date string and adds/subtracts days to/from it.
            // To subtract days, pass in a negative number
            var adjusted_date = new Date(date_str);
            var day = adjusted_date.getDate();
            if (isNaN(day)) {
                return '';
            }
            else {
                adjusted_date.setDate(day + day_adjustment);
                return adjusted_date;
            }
        }
        ,
        applyDefaultTime: function(date_str, input, time_str) {
            // date_str is a string
            // input is a YUI element
            // time_str can be passed if you want to do something other than 11:59pm
            // if time string not present, use default 11:59 pm
            adjustedDateString = date_str;
            adjustedTimeString = (time_str) ? time_str : " at 11:59pm";
            if (date_str != '' && !date_str.match(/\s+(at\s+)?\d+:\d+\s*(am|pm)?\s*$/i)) {
                adjustedDateString += adjustedTimeString;
                input.set && input.set('value', adjustedDateString);
            }
        }
        ,
        formatDuration: function(format, duration, noDays) {
            // formats a 'duration' (in seconds) according to 'format', where %d is days elapsed
            // (unless 'noDays' is true, in which case its length is wrapped into %h and %d is always 0),
            // %h is the fractional remainder of days (%d) in hours (or it includes the length in days if 'noDays' is true),
            // %m is the fractional remainder of hours (%h) in minutes, and %s is the fractional remainder of minutes (%m) in seconds
            // -- %D, %H, %M, and %S are intended as standalone values, each of which express the entire duration in
            // days (rounded), hours (rounded), minutes (rounded), and seconds respectively
            if (format.match(/\%/)) {
                var days = noDays ? 0 : parseInt(duration/86400);
                var hrs  = noDays ? parseInt(duration/3600) : parseInt((duration%86400)/3600);
                var mins = parseInt((duration%3600)/60);
                var secs = parseInt(duration%60);

                // days + hrs + mins + secs = total time
                var totalSecs = parseInt(duration); // total secs
                var totalMins = parseInt(duration/60)    + (secs >= 30); // total mins (rounded)
                var totalHrs  = parseInt(duration/3600)  + (mins >= 30); // total hrs (rounded)
                var totalDays = parseInt(duration/86400) + (hrs  >= 12); // total days (rounded)

                // format time
                format = format.replace(/\%d/, days);
                format = format.replace(/\%h/, hrs);
                format = format.replace(/\%m/, mins);
                format = format.replace(/\%s/, secs);
                format = format.replace(/\%D/, totalDays);
                format = format.replace(/\%H/, totalHrs);
                format = format.replace(/\%M/, totalMins);
                format = format.replace(/\%S/, totalSecs);
            }
            return format;
        }
        ,
        formatDurationMinutes: function(duration, noUnits) {
            var format = noUnits ? '' : 'm';
            if (duration < 30) return '&lt;1'+format;
            return Mx.Util.formatDuration('%M'+format, duration, 0);
        }
        ,
        // copies any Array/Object oriented non-self-referencing structure
        copyTree: copyTree
        ,
        navigateAwayMsg: function () { return 'Your changes have not been saved. Discard changes?'; }
        ,
        navigateAwayOKCancelMsg: function () { return Mx.Util.navigateAwayMsg() + '\n\nPress OK to continue, or Cancel to stay on the current page.'; }
        ,
        /**
         * Returns a function that can be set as the responseFailureHandler
         * in a call to Mx.Ajax.handleResponse
         *
         * @param {String} msg Error message
         * @param {Object} bypassUnloads An object with a bypassUnloads field,
         *   which is set to true in this method (and hence, the change is
         *   propagated back to the calling object). Typically used to allow 
         *   browser to navigate back to login page when session has timed out.
         */
        getTimeoutBehavior: function (msg, bypassUnloadsObj) {
            var timeoutErrorMsg = msg || 'Your session has timed out.';
            var timeoutBehavior = function() {
                bypassUnloadsObj.bypassUnloads = true;
                var callback = function() {
                    top.location = top.location;
                };
                Mx.modalManager.displayErrorModal(timeoutErrorMsg, callback);
            }
            return timeoutBehavior;        
        }
        ,
        getScorePendingIcon: function() {
            var scorePendingText = 'Score is provisional because one or more elements have yet to be graded';
            return '<img alt="'+scorePendingText+'" title="'+scorePendingText+'" src="' + MxConf.assetsPathImg + '/pencil.png"/>';
        }
        ,
        openHelpWindow: function(help_url) {
            Mx.browser.popup(help_url, 'mxhelp', 800, 600, 'scrollbars=yes,resizable=yes');
        }
        ,
        instrumentHelpLink: function(node) {
            // Takes a node to an anchor that contains the href for the help page
            // to pop up using openHelpWindow
            node.on('click', function(e) {
                e.preventDefault();
                var href = e.target.getAttribute('href') || e.target.ancestor().getAttribute('href');
                Mx.Util.openHelpWindow(href);
            });
        }
        ,
        assistantPrivMsg: function () { return 'You are a section instructor in this course without the privilege needed to complete this action. The course instructor can give you this privilege.'; }
        ,
        assistantPrivAlert: function () { alert(Mx.Util.assistantPrivMsg()); }
        ,
        setSubmitPriv: function (hook, selector, canUpdate) {
            Mx.yui.inst().use('node', function (Y) {
                function privAlert (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    Mx.Util.assistantPrivAlert();
                }
                function makeSetSubmit () {
                    if (!Boolean(canUpdate)) {
                        return function () {
                            Y.all(selector).each(function (node) {
                                var container, clickTrap;
                                node.setAttribute('disabled', 'disabled');
                                // IE propagates clicks from disabled elements
                                // combined with a z-index bug, you get a big mess
                                container = Y.Node.create('<span class="maynot"/>');
                                container.on('click', privAlert);
                                clickTrap = Y.Node.create('<span class="click-trap"/>');
                                clickTrap.set('id', node.get('id')+'-click-trap');
                                clickTrap.on('click', privAlert);
                                container.appendChild(clickTrap)
                                container.appendChild(node.cloneNode(true));
                                node.get('parentNode').replaceChild(container, node);
                            });
                        };
                    } else {
                        return function () {
                            // the page may have the button in any initial state
                            Y.all(selector).each(function (node) { node.removeAttribute('disabled'); });
                        };
                    }
                }
                Y.on('contentready', makeSetSubmit(), hook);
            });
        },
        renderSelectNode: function (Y, container, valueTextList, onChangeCallback, selectedValue, extraAttrs, utf8Decode) {

            var i, length, select;

            if (!valueTextList || !valueTextList.length) {
                alert('No value-text list');
                return;
            }
            length = valueTextList.length;

            var selectedIndex = 0;
            select = Y.Node.create('<select/>');
            for (i = 0; i < length; i++) {
                var optionValue = valueTextList[i].value || valueTextList[i].url || '';
                var optionText = (utf8Decode) ? this.decode_utf8(valueTextList[i].text) : valueTextList[i].text;
                var node = Y.Node.create('<option value="'+optionValue+'">'+optionText+'</option>');
                if (selectedValue && selectedValue == optionValue) {
                    node.setAttribute('selected', 'selected');
                    selectedIndex = i;
                }
                select.appendChild(node);
            }
            select.set('selectedIndex', selectedIndex);
            if (onChangeCallback) Y.on('change', onChangeCallback, select);
            if (extraAttrs) {
              for (i in extraAttrs) {// naming the argument 'class' causes problems with IE7, so use className
                  if (i == 'className') {
                    select.addClass(extraAttrs[i]);
                  } else {
                    select.set(i, extraAttrs[i]);
                  }
              }
            }

            container.appendChild(select);
        },
        rebuildNode: function (Y, node, buildCallBack) {
            node.set('innerHTML', ''); // until a better way
            buildCallBack(node);
        },
        timerCountDown: function (secondsAvailable, timeUpURI, showAlert) {
            var startSeconds = secondsAvailable;
            if (! typeof parseInt(startSeconds) == 'number') {
                Y.one('#the-time').set('innerHTML', 'error');
                return;
            }

            // Calculate the number of hours left
            var hours = Math.floor(startSeconds/3600);
            // After hours , how many minutes are left
            var minutes = Math.floor((startSeconds - (hours*3600))/60);
            // How many seconds are left after removing hours and minutes
            var secs = Math.floor((startSeconds - (hours*3600) - (minutes*60)));

            // Format hours, minutes and seconds
            if (secs<=9) { secs = "0" + secs; }
            if (minutes<=9) { minutes = "0" + minutes; }
            if (hours<=9) { hours = "0" + hours; }

            // Make timer visible and display time in different color when 2 minutes or less is left
            var warnAtSeconds = 120;
            if (startSeconds == warnAtSeconds) {
                Y.one('#show-time').addClass('invisible');
                Y.one('#countdown').removeClass('invisible');
            }
            if (startSeconds <= warnAtSeconds) Y.one('#the-time').addClass('time-warn');

            // Update timer on page
            var timeStr = hours + ':' + minutes + ':' + secs;
            Y.one('#the-time').set('innerHTML', timeStr);

            // Decrement counter
            startSeconds--;
            var myTime = Y.later(1000, null, function() { Mx.Util.timerCountDown(startSeconds, timeUpURI, showAlert); });

            // Display alert if time is up
            if (hours == '00' && minutes == '00' && secs == '00') {
                startSeconds = 0;
                myTime.cancel();
                if (showAlert) alert('Your time is up. You cannot submit any more answers for this assignment.');
                if (! timeUpURI) { // timeUpURI is set to null when limitStudentAccess is in effect
                    // Close popup window containing assignment or item
                    self.close();
                } else {
                    // Re-load assignment view page
                    window.bypassAccessUnloads = true;
                    self.location.href = timeUpURI;
                }
            }
        },
        saveDisplaySetting: function (setting, settingValue) {
            var ioArgs = {
                action: 'setUserSettings'
            };
            ioArgs[setting] = settingValue;
            Mx.Ajax.handleRequest({
                ioArgs : ioArgs
            });
            return true;
        },
        checkSafariBeforeEdit: function (text) {
            if (Mx.browser.s && (!text || text.match(/(Edit|Manage)/))) {
                var w = 600
                    , h = 150;
                var left = (screen.width - w)/2
                    , top = (screen.height - h)/2;
                var editHelpWindow = Mx.browser.popup('', 'editHelpWin', w, h, 'left='+left+',top='+top+',toolbar=no,titlebar=no,resizable=no,scrollbars=no');
                editHelpWindow.focus();
                editHelpWindow.document.writeln('<p style="padding:5px;font:13px arial,sans-serif;"><b>ALERT:</b> Your current working environment does not appear to be compatible with the Simple Editor. Please switch to a supported browser as listed in the latest System Requirements.</p>');
                editHelpWindow.document.writeln('<p style="text-align:center;font:13px arial,sans-serif;">[ <a href="javascript:self.close()">close this window</a> ]</p>');
                return false;
            }
            return true;
        },
        toggleDisabled: function (node, disable) {
            if (node) {
                var isInputElement = (node.get('tagName') == 'INPUT' || node.get('tagName') == 'SELECT') ? 1 : 0;
                if (disable) {
                    if (isInputElement) {
                        node.set('disabled', 'disabled');
                    } else {
                        node.addClass('disabled');
                        node.all('div').addClass('disabled');
                        node.all('input').set('disabled', 'disabled');
                        node.all('select').set('disabled', 'disabled');
                    }
                }
                else {
                    if (isInputElement) {
                        node.set('disabled', '');
                    } else {
                        node.removeClass('disabled');
                        node.all('div').removeClass('disabled');
                        node.all('input').set('disabled', '');
                        node.all('select').set('disabled', '');
                    }
                }
            }
        },
        renderStatBarSpur: function (spurWidth, spurImage, totalCols) {
            if (spurWidth <= 0) return;
            var spurRow = Y.Node.create(
            '<tr><td colspan="'+totalCols+'">'+
                '<img class="statBarImg" src="'+Mx.Util.imageUri('clearpix.gif')+'" width="'+spurWidth+'" height="4" />'+
                '<img class="statBarImg" src="'+Mx.Util.imageUri(spurImage)+'" width="3" height="4" />'+
            '</td></tr>'
            );
            return spurRow;
        },
        renderStatBarCell: function (cell) {
            var barHeight = 6;
            var colorCodes = {
              green       : '#00FF00',
              red         : '#FF0000',
              orange      : '#FF7D0B',
              gold        : '#EBB906',
              gray        : '#CCCCCC',
              blue        : '#0000FF',
              yellow      : '#FFFF00',
              redorange   : '#CC4400',
              brown       : '#996633',
              clear       : 'transparent'
            };
            var title = Mx.Util.escapeHTML(cell.title);
            var statCell = 
            '<td class="statBarCell" title="'+title+'" style="background-color: '+colorCodes[cell.color.toLowerCase() || 'clear']+';">'+
                '<img class="statBarImg" src="'+Mx.Util.imageUri('clearpix.gif')+'" width="'+cell.width+'" height="'+(cell.height || barHeight)+'" alt="'+title+'"/>'+
            '</td>';
            return statCell;
        },
        renderStatBarTable: function (stats, barLength, barType) {
            var students = parseInt(stats.students)
              , correct = parseInt(stats.correct) || 0
              , solutions = parseInt(stats.solutions) || 0
              , wrong = parseInt(stats.wrong) || 0
              , hints = parseInt(stats.hints) || 0;

            if (!students) return;

            function formatTooltipNumber (x) {
                var tooltip = Number(x).toFixed(2);
                return tooltip.toString();
            }

            var statBarTable = Y.Node.create(
                '<table>'+
                    '<tbody></tbody>'+
                '</table>');

            var statBarTbody = statBarTable.one('tbody');

            if (barType == 'problemReport' || barType == 'libraryReport') {
                var totalAnswers = correct + solutions;
                var correctPct = totalAnswers ? (correct / totalAnswers * 100) : 0;
                var solutionsPct = totalAnswers ? (solutions / totalAnswers * 100) : 0;
                var pixPer = totalAnswers ? barLength / totalAnswers : 0;

                var correctPx = Math.floor(correct * pixPer + 1);
                var solutionsPx = Math.floor(solutions * pixPer + 1);

                var spurWidth = correctPx + solutionsPx;
                var totalCols = 4;

                statBarTbody.append(Mx.Util.renderStatBarSpur(spurWidth, 'bar_spur_top.gif', totalCols));

                var statBarRow = Y.Node.create(
                    '<tr>'+
                    Mx.Util.renderStatBarCell({
                        title: formatTooltipNumber(correctPct) + '\% answered correctly'
                        , color: 'green'
                        , width: correctPx
                    })+
                    Mx.Util.renderStatBarCell({
                        title: formatTooltipNumber(solutionsPct) + '\% requested answer'
                        , color: 'red'
                        , width: solutionsPx
                    })+
                    Mx.Util.renderStatBarCell({
                        title: 'Avg. of ' + formatTooltipNumber(wrong/students) + ' wrong answers per student'
                        , color: 'orange'
                        , width: Math.floor(0.7 * barLength * wrong / (students + wrong)) + 1
                    })+
                    Mx.Util.renderStatBarCell({
                        title: 'Avg. of ' + formatTooltipNumber(hints/students) + ' hints per student'
                        , color: 'gold'
                        , width: Math.floor(0.7 * barLength * hints / (students + hints)) + 1
                    })+
                    '</tr>'
                );
                statBarTbody.append(statBarRow);

                statBarTbody.append(Mx.Util.renderStatBarSpur(spurWidth, 'bar_spur_bottom.gif', totalCols));

            } else if (barType == 'partReport') {
                var finished = correct + solutions;
                var unfinished = (students > finished) ? (students - finished) : 0;
                var unfinishedPct = students ? (unfinished / students * 100) : 0;
                var correctPct = students ? (correct / students * 100) : 0;
                var solutionsPct = students ? (solutions / students * 100) : 0;
                var pixPer = (correct || solutions || unfinished) ? barLength / (correct + solutions + unfinished) : 0;

                var correctPx = Math.floor(correct * pixPer + 1);
                var unfinishedPx = Math.floor(unfinished * pixPer + 1);
                var solutionsPx = Math.floor(solutions * pixPer + 1);

                var spurWidth = correctPx + unfinishedPx + solutionsPx + 1;
                var totalCols = 5;

                statBarTbody.append(Mx.Util.renderStatBarSpur(spurWidth, 'bar_spur_top.gif', totalCols));

                var statBarRow = Y.Node.create(
                    '<tr>'+
                    Mx.Util.renderStatBarCell({
                        title: formatTooltipNumber(correctPct) + '\% answered correctly'
                        , color: 'green'
                        , width: correctPx
                    })+
                    Mx.Util.renderStatBarCell({
                        title: formatTooltipNumber(unfinishedPct) + '\% never finished'
                        , color: 'gray'
                        , width: unfinishedPx
                    })+
                    Mx.Util.renderStatBarCell({
                        title: formatTooltipNumber(solutionsPct) + '\% requested answer'
                        , color: 'red'
                        , width: solutionsPx
                    })+
                    Mx.Util.renderStatBarCell({
                        title: 'Avg. of ' + formatTooltipNumber(wrong/students) + ' wrong answers per student'
                        , color: 'orange'
                        , width: Math.floor(0.7 * barLength * wrong / (students + wrong)) + 1
                    })+
                    Mx.Util.renderStatBarCell({
                        title: 'Avg. of ' + formatTooltipNumber(hints/students) + ' hints per student'
                        , color: 'gold'
                        , width: Math.floor(0.7 * barLength * hints / (students + hints)) + 1
                    })+
                    '</tr>'
                );
                statBarTbody.append(statBarRow);

                statBarTbody.append(Mx.Util.renderStatBarSpur(spurWidth, 'bar_spur_bottom.gif', totalCols));
            }

            return statBarTable;
        }

    };

    Mx.Util = Util;

});

//
// Mx.MenuPopup inline module definition
//

Mx.y.add('Mx.MenuPopup', function(Y) {

    if (Mx.MenuPopup) {
        return;
    }

    var MenuPopup = {

        makeInit: function() { // Use with same args as create().  Returns a reference to create() bound with arguments passed to makeInit().
            return Function.prototype.bind.apply(this.create, [this].concat([].slice.call(arguments)));
        }
        ,
        create: function(anchorID, menuID, config) {
            config = config || {};
            var regex = /^(T|C|B)(L|C|R)$/i,
                anchorAlign = (config.anchorAlign && regex.test(config.anchorAlign)) ? config.anchorAlign.toUpperCase() : 'BL',
                panelAlign = (config.panelAlign && regex.test(config.panelAlign)) ? config.panelAlign.toUpperCase() : 'TL',
                modal = Mx.Util.isBoolean(config.modal) ? config.modal : false,
                headerContent = config.headerContent ? config.headerContent : null,
                footerContent = config.footerContent ? config.footerContent : null,
                preCenter = Mx.Util.isBoolean(config.preCenter) ? config.preCenter : false,
                classMark = config.classMark ? config.classMark : null,
                zIndex = Mx.Util.isNumber(config.zIndex) ? parseInt(config.zIndex) : 10,
                width = config.width ? config.width : null,
                closeID = config.closeID ? config.closeID : null,
                hideOnCloseOnly = config.hideOnCloseOnly ? config.hideOnCloseOnly : false,
                fnHide = Mx.Util.isFunction(config.fnHide) ? config.fnHide : null,
                fnShow = Mx.Util.isFunction(config.fnShow) ? config.fnShow : null,
                fnAfterInit = Mx.Util.isFunction(config.fnAfterInit) ? config.fnAfterInit : null;

            var anchor = Y.one(anchorID),
                menu = Y.one(menuID);

            if (anchor && menu) {
                // Relocate the menu to the document body where it can be best positioned and z-indexed
                menu.get('parentNode').removeChild(menu);
                Y.one(document.body).appendChild(menu);

                var panel = new Y.Panel({
                    srcNode: menu,
                    headerContent: headerContent,
                    footerContent: footerContent,
                    width: width,
                    visible: false,
                    constrain: true,
                    modal: modal,
                    render: true,
                    zIndex: zIndex,
                    alignOn: [
                        {
                            node: Y.one(window),
                            eventName: 'resize'
                        }
                    ]
                });
                if (!hideOnCloseOnly) { // panel will close if user clicks anywhere outside of panel unless config value is set for this behavior to be overridden
                    panel.set('hideOn', [ {eventName: 'clickoutside'} ]);
                }
                if (preCenter) {
                    panel.centered(); // For cases in which invisible panel would force horizontal scrollbar
                    panel.on('render', function () {
                        this.align(anchor, [Y.WidgetPositionAlign[panelAlign], Y.WidgetPositionAlign[anchorAlign]]);
                    });
                }
                else {
                    panel.align(anchor, [Y.WidgetPositionAlign[panelAlign], Y.WidgetPositionAlign[anchorAlign]]);
                }

                menu.setStyle('display', 'block');

                Mx.getOverlayManager().register(panel);

                panel.on('visibleChange', function(e) {
                    var visible = e.newVal; // e.newVal will be true when made visible, false when hidden
                    if (visible) {
                        this.blur();
                        if (fnShow) fnShow();
                    }
                    else {
                        if (fnHide) fnHide();
                    }
                });

                anchor.on('click', function(e) {
                    e.preventDefault();
                    if (panel.get('visible')) {
                        panel.hide(); // not necessary?
                    }
                    else {
                        panel.show();
                    }
                });

                if (closeID) Y.one(closeID).on('click', function (e) {
                    e.preventDefault();
                    panel.hide();
                });

                if (classMark) {
                    // These guys are apparently delayed in creation: wait for their readiness
                    var panelSelector = '#' + panel.get('id');
                    Y.on('contentready', function() { Y.one(panelSelector).addClass(classMark) }, panelSelector);
                }

                if (fnAfterInit) { // Keep this last
                    fnAfterInit();
                }
            }
        }
    };

    Mx.MenuPopup = MenuPopup;

}, '0.0.1', {
    requires: ['node', 'panel']
});

//
// Mx.PopupWindow inline module definition
//

Mx.y.add('Mx.PopupWindow', function(Y) {

    if (Mx.PopupWindow) {
        return;
    }

    var PopupWindow = function (config) {

        var popupWindows = {}; // refreshed every time user navigates in main window

        var closeAll = function() {
            for (var target in popupWindows) {
                var popup = popupWindows[target];
                if (popup && !popup.closed) {
                    try {
                        popup.bypassAccessUnloads = true;
                    } catch(e) {
                        console.log('Closed popup window for Amplifire or other non-Mastering domain.');
                    }
                    popup.close();
                }
                delete popupWindows[target];
            }
        };
        window.closeAllPopupWindows = closeAll;

        var openPopupUrl = function (config) {
            // openPopupUrl method takes a config object with the following properties to specify its rendering:
            // - target: Optional target for this window
            // - contentUrl: the URL to show in the popup
            // - width: Optional width for the popup
            // - height: Optional height for the popup
            // - movedown: Optional offset from top for the popup
            // - moveright: Optional offset from left for the popup
            // - locationbar : Optional setting to enable the location bar
            // - menubar : Optional setting to enable the menu bar
            // - resizable : Optional setting to make window resizable
            // - scrollbars : Optional setting to enable scrollbars
            // - statusbar : Optional setting to enable status bar
            // - toolbar : Optional setting to enable tool bar
            // - onbeforeunload : Optional onbeforeunlad event handler for the popup (do NOT use in contexts that already have one)

            var target = Mx.Util.isString(config.target) || Mx.Util.isNumber(config.target) ? config.target : '_blank';
            var contentUrl = Mx.Util.isString(config.contentUrl) ? config.contentUrl : false;
            var width = Mx.Util.isNumber(config.width) ? config.width : ( screen.width > 1400 ? 1024 : parseInt(screen.width * 0.80) ); // Set popup to default width unless the screen too small
            var height = Mx.Util.isNumber(config.height) ? config.height : ( screen.height > 1000 ? 850 : parseInt(screen.height * 0.80) ); // Set popup to default height unless the screen too small
            var movedown = Mx.Util.isNumber(config.movedown) ? config.movedown : 20;
            var moveright = Mx.Util.isNumber(config.moveright) ? config.moveright : (screen.width - width)/2;
            var locationbar = Mx.Util.isBoolean(config.locationbar) ? config.locationbar : true;
            var menubar = Mx.Util.isBoolean(config.menubar) ? config.menubar : true;
            var resizable = Mx.Util.isBoolean(config.resizable) ? config.resizable : true;
            var scrollbars = Mx.Util.isBoolean(config.scrollbars) ? config.scrollbars : true;
            var statusbar = Mx.Util.isBoolean(config.statusbar) ? config.statusbar : true;
            var toolbar = Mx.Util.isBoolean(config.toolbar) ? config.toolbar : true;
            var onbeforeunload = Mx.Util.isFunction(config.onbeforeunload) ? config.onbeforeunload : null;

            if (! contentUrl) return false;

            var canReusePopup = false;
            if (popupWindows[target] && ! popupWindows[target].closed) { // check whether we can re-use the existing popup window
                try {
                    if (popupWindows[target].location.host === window.location.host) {
                        canReusePopup = true;
                    }
                } catch(e) {
                    canReusePopup = false;
                }
            }
            
            var popup;
            if (canReusePopup) { // re-use existing popup with same target
                popup = popupWindows[target];
                popup.onbeforeunload = null;
                popup.location = contentUrl;
            }
            else {
                var paramsHash = {
                    width : width,
                    height : height,
                    top : movedown,
                    left : moveright,
                    location : locationbar ? 'yes' : 'no',
                    menubar : menubar ? 'yes' : 'no',
                    resizable : resizable ? 'yes' : 'no',
                    scrollbars : scrollbars ? 'yes' : 'no',
                    statusbar : statusbar ? 'yes' : 'no',
                    toolbar : toolbar ? 'yes' : 'no'
                };

                var params = [];
                for (var param in paramsHash) {
                    params.push(param + '=' + paramsHash[param]);
                }
                var paramsStr = params.join(',');
                popup = window.open(contentUrl, target, paramsStr);

                if (! popup) {
                    alert('Error: You must configure your browser to allow popup windows for this site.');
                    return false;
                }

                if (onbeforeunload) {
                    popup.onbeforeunload = onbeforeunload;
                }

                if (target != '_blank') { // assume that _blank target popups should not be reused
                    popupWindows[target] = popup;
                }
            }
            popup.focus();
            return popup;
        };

        return {
            openPopupUrl : openPopupUrl
        };

    }();

    Mx.PopupWindow = PopupWindow;

});

//
// Mx.Util.ModalManager inline module definition
//

Mx.y.add('Mx.Util.ModalManager', function(Y) {

    if (!Mx.Util) {
        throw new Error('Mx.Util.ModalManager requires that Mx.Util have been loaded first.');
    }

    if (Mx.Util.ModalManager) {
        return;
    }

    function ModalManager() {
        this._modal = null;
        this._titleNode = null;
        this._iframeNode = null;
        this._printButtonNode = null;
        this._confirmCloseMessage = null;
        this._onDestroy = null;
        this._window = window;
        this._opening_mutex = false;
    }

    ModalManager.prototype = {
        setCurrentModal: function(modal) {
            this._modal = modal;
        }
        ,
        getCurrentModal: function() {
            return this._modal;
        }
        ,
        getActiveModalManager: function() {
            // getActiveModalManager obtains an instance of a ModalManager that is
            // currently carrying an active modal.  It will look up through parent
            // windows until it finds one.  The purpose of this function is to
            // support other methods on ModalManager and give them the ability
            // to work from children documents' Mx.modalManager instance without
            // having to worry about where they are executing in a nested document
            // heirarchy (e.g. within modals and iframes within those modals).
            var crossdomainException
              , modalManager = null;
            for (var modal_owner = window ; ; modal_owner = modal_owner.parent) { // No loop condition by intention
                try {
                    modalManager = modal_owner.Mx && modal_owner.Mx.modalManager;
                } catch (crossdomainException) {
                    return null;
                }
                if (modalManager && modalManager._modal) {
                    return modalManager;
                }
                if (modal_owner == modal_owner.parent) break; // root frame
            }
            return null;
        }
        ,
        setupNewMaskNode: function(id, zIndex, renderNode) {
            // Use to create individual nodeMasks for individual panels
            id = id || new Date().getTime();
            var maskNode = Y.Node.create(
                '<div id="' + id + '" class="modal-panel-mask" style="z-index:' + zIndex + '"></div>'
            );
            if (renderNode) {
                maskNode.addClass('custom-mask');
                renderNode.append(maskNode);
            } else {
                Y.one('body').insert(maskNode, 0);
            }
            return maskNode;
        }
        ,
        openModalPanel: function(config) { // Generic function for opening modal panels (currently just for non-iframe panels)
            // openModalPanel method takes a config object with the following properties to specify its rendering:
            // - panelContentID: id for the panel (required)
            // - message: the text message to be displayed
            // - className: class name to add to panel, if supplied
            // - yesText: the text of the Yes button
            // - noText: the text of the No button
            // - yesCallback: called upon clicking Yes button, if supplied
            // - noCallback: called upon clicking No button, if supplied
            // - width: width of the window, if supplied
            // - zIndex: zIndex, if supplied
            // - onRender: callback to execute onRender, if supplied
            // - doNotRender: boolean flag to indicate panel should not be rendered, if supplied
            // - renderNode: node under which the panel is to be rendered, if supplied. Default is body of current document

            config = config || {};

            var msg = config.message ? config.message : 'You forgot to include a message',
                width = config.width ? config.width : null,
                zIndex = config.zIndex ? config.zIndex : 10,
                onRender = Mx.Util.isFunction(config.onRender) ? config.onRender : null,
                yesText = config.yesText ? config.yesText : null,
                noText = config.noText ? config.noText : null,
                panelContentID = config.panelContentID ? config.panelContentID : 'generic',
                className = config.className ? config.className : null,
                doNotRender = Mx.Util.isBoolean(config.doNotRender) ? config.doNotRender : false,
                renderNode = config.renderNode ? config.renderNode : null;

            // Define various event handlers for panel
            var handleYes = function() {
                this.hide();
                if (config.yesCallback) config.yesCallback();
            };
            var handleNo = function() {
                this.hide();
                if (config.noCallback) config.noCallback();
            };

            var srcNode = Y.Node.create('<div id="' + panelContentID + '"><div class="yui3-widget-bd">' +  msg + '</div></div>');
            var maskNode = this.setupNewMaskNode(panelContentID + '-mask', zIndex, renderNode);

            var footerButtons;
            if (yesText) {
                footerButtons = [
                    {
                        name: 'yes',
                        label: yesText,
                        action: handleYes,
                        isDefault: true
                    }
                ];
            }

            if (noText) {
                footerButtons = footerButtons || [];
                footerButtons.push({
                    name: 'no',
                    label: noText,
                    action: handleNo
                });
            }

            var modalPanel = new Y.Panel({
                srcNode: srcNode,
                maskNode: maskNode,
                width: width,
                visible: false,
                centered: renderNode ? renderNode : true,
                modal: renderNode ? false : true,
                render: (doNotRender || renderNode) ? false : true,
                constrain: true,
                zIndex: zIndex + 1, // make zIndex of panel higher than mask
                buttons: footerButtons ? {
                    footer: footerButtons
                } : null,
                alignOn: [
                    {
                        node: Y.one(window),
                        eventName: 'resize'
                    }
                ]
            });

            modalPanel.on('visibleChange', function(e) {
                var hidden = !e.newVal; // e.newVal will be true when made visible, false when hidden
                if (hidden) {
                    maskNode.remove(true);
                    this.destroy();
                }
            });

            if (! doNotRender) {
                modalPanel.render(renderNode);
                onRender && onRender();
                if (className) {
                    Y.one('#' + modalPanel.get('id')).addClass(className);
                }
                modalPanel.show();
                modalPanel.blur();
            }

            return modalPanel;
        }
        ,
        openModalProgressIndicator: function(config) {
            // Accepts config settings available to openModalPanel()

            config = config || {};

            // mutex stuff needed so that panel can be closed from page
            var mm_this = this;
            if ( mm_this._opening_mutex ) {
                return;
            }
            mm_this._opening_mutex = true;

            config.panelContentID = 'modal-progress-panel';
            var temp = config.message ? '. ' + config.message : '...';
            // Rework config.message for this panel
            config.message = '<div class="progress-msg"><span class="default">Please wait</span>' + temp + '</div><div class="progress-img"></div>';

            var modalPanel = this.openModalPanel(config);

            mm_this.setCurrentModal(modalPanel);
            mm_this._opening_mutex = false;
        }
        ,
        openModalAlert: function(config) {
            // Accepts config settings available to openModalPanel(), and the following:
            // - modalType: opens error modal, if set to 'error'
            // - url: navigates to this location, if supplied
            // - callback: called upon completion, if supplied

            config = config || {};

            config.panelContentID = (config.modalType && config.modalType == 'error') ? 'modal-error-panel' : 'modal-alert-panel';
            config.yesText = 'OK';
            config.yesCallback = function() {
                if (config.url) {
                    window.location = config.url;
                }
                else if (config.callback) {
                    config.callback();
                }
            };

            this.openModalPanel(config);
        }
        ,
        openModalConfirm: function(config) {
            // Accepts config settings available to openModalPanel() and the following:
            // - headline: the header of the text message, if supplied

            config = config || {};

            config.panelContentID = 'modal-confirm-panel';
            config.yesText = config.yesText ? config.yesText : 'Yes'; // mandatory

            var temp = config.message ? config.message : 'You forgot to include a message';
            config.message = '<h1 class="headline">' + (config.headline ? config.headline : '') + '</h1>' +  temp;

            this.openModalPanel(config);
        }
        ,
        openNoAddAdaptiveAlert: function(config) {
            // Accepts config settings available to openModalPanel(), and the following:
            // - messageType: the text messageType to be displayed
            // - editUrl: navigates to this location on clicking 'edit' in panel

            config = config || {};

            var messageType = config.messageType ? config.messageType : '';
            var msg;
            if (messageType == 'noAdaptiveItems') {
                msg = '<p>More Publisher Items Needed</p><p>Adaptive Follow-Up assignments require that at least one publisher item from the main textbook for this course be included in the Parent assignment.</p><p>If you\'d still like to add an Adaptive Follow-Up for this assignment, please <span id="edit-assignment-step1-link" class="linky">edit</span> the assignment, add publisher items and try again.</p>';
            }
            else if (messageType == 'noAdaptiveChapters') {
                msg = '<p>Coming Soon</p><p>Adaptive Follow-Up assignments are not yet available for the selected chapters; we are working to release them as soon as we can.</p>';
            }

            config.message = '<h1 class="headline">Unable to Add Adaptive Follow-Up</h1>' +
                          '<div class="followup icon medium">&nbsp;</div>' + msg + '';
            config.panelContentID = 'modal-no-add-adaptive-panel';
            config.yesText = 'OK';
            config.width = '525px';
            config.doNotRender = true;

            var modalPanel = this.openModalPanel(config);

            modalPanel.render();
            // Instrument the 'edit' link, if present in this message
            var editAssignmentLink = Y.one('#edit-assignment-step1-link');
            editAssignmentLink && editAssignmentLink.on('click', function (e) {
                e.preventDefault();
                modalPanel.hide();
                if (config.editUrl) window.location.href = config.editUrl;
            });
            modalPanel.show();
            modalPanel.blur();
        }
        ,
        // TODO : consider calling openModalPanel() from within openModalUrl()
        openModalUrl: function(config) {
            // openModalUrl method takes a config object with the following properties
            // to specify its rendering and behavior:
            // - title: the main window title
            // - titleHover: hover text for the main window title
            // - contentUrl: the URL to show in the enclosed iframe
            // - helpUrl: the URL to show when Help is clicked, empty for no Help
            // - print: adds a print link next to help if true
            // - width: Optional fixed-width for the modal
            // - height: Optional fixed-height for the modal (not too useful, actually!)
            // - hmargin: Optional horizontal margin in pixels (split between left and right)
            // - vmargin: Optional vertical margin in pixels (split between top and bottom)
            // - onDestroy : Optional callback to execute after modal is dismissed
            //      Use onDestroy config option instead of executing Mx.modalManager.redirect/refreshWindowOnDestroy
            //      immediately after Mx.modalManager.openModalUrl, as the latter may result in race conditions.  (See MX-2369.)
            //      Or, just set without a function for default behavior of parent window refresh.

            var mm_this = this;
            if ( mm_this._opening_mutex ) {
                return;
            }
            mm_this._opening_mutex = true;

            if (config.onDestroy) {
                mm_this._onDestroy = Mx.Util.isFunction(config.onDestroy) ? config.onDestroy : this.refreshWindow;
            }

            // config.print - if true, add a print button that will js print the contents of the modal when clicked
            var printContainerID = 'print-container',
                printContainerSelector = '#' + printContainerID,
                printContainerContent = '',
                printAction = null;

            if (config.print) {
                printContainerContent = '<span id="' + printContainerID + '" class="invisible"><a id="print-button" class="action">Print</a>|</span>';
                printAction = function(e) {
                    e.preventDefault();
                    frames["modalFrame"].focus();
                    frames["modalFrame"].print();
                };
            }

            var helpContainerID = 'help-container',
                helpContainerSelector = '#' + helpContainerID,
                helpContent = ''
                helpAction = null;

            // config.helpUrl overrides default MxConf.helpBaseURL, which should always exist
            var helpUrl = config.helpUrl || MxConf.helpBaseURL;

            if (helpUrl) {
                helpContent = '<span id="' + helpContainerID + '"><a href="' + helpUrl + '" class="action">Help</a>|</span>';
                helpAction = function(e) {
                    e.preventDefault();
                    Mx.Util.openHelpWindow(e.target.getAttribute('href'));
                };
            }

            var closeLinkID = 'modal-close-link',
                closeLinkSelector = '#' + closeLinkID;
            var closeContent = '<span id="' + closeLinkID + '" class="action">Close</span>';

            var titleContent = '<div class="title"' + (config.titleHover ? ' title="' + config.titleHover + '"' : '') + '>' + (config.title ? Mx.Util.trunc(config.title, 80, true, true) : '&nbsp;') + '</div>';

            var headerContent = '<div class="right-container">' + printContainerContent + helpContent + closeContent + '</div>' + titleContent;

            var iframe = '<iframe name="modalFrame" title="' + (config.title || 'Modal Pop-up') + '" frameBorder="0" marginWidth="0" marginHeight="0" style="height:100%;width:100%"></iframe>';

            var zIndex = config.zIndex ? config.zIndex : 1000;

            var panelContentID = 'modal-iframe-panel',
                panelContent = '<div id="' + panelContentID +'"><div class="yui3-widget-bd">' + iframe + '</div></div>';

            var srcNode = Y.Node.create(panelContent);
            var maskNode = this.setupNewMaskNode(panelContentID + '-mask', zIndex);

            var bodyNode = Y.one(document.body);

            var computePanelWidth = function() {
                return (config.width+0) || (bodyNode.get('winWidth') - (config.hmargin+0 ? (config.hmargin+0) : 80));
            };

            var computePanelHeight = function() {
                return (config.height+0) || (bodyNode.get('winHeight') - (config.vmargin+0 ? (config.vmargin+0) : 50));
            };

            var panel = new Y.Panel({
                srcNode: srcNode,
                maskNode: maskNode,
                headerContent: headerContent,
                width: computePanelWidth() + 'px',
                height: computePanelHeight() + 'px',
                centered: true,
                visible: false,
                modal: true,
                render: true,
                constrain: true,
                zIndex: zIndex + 1, // make zIndex of panel higher than mask
                alignOn: [
                    {
                        node: Y.one(window),
                        eventName: 'resize'
                    }
                ]
            });

            var panelID = panel.get('id'),
                panelNode = Y.one('#' + panelID);

            var resizePanel = function() {
                panel.set('width', computePanelWidth());
                panel.set('height', computePanelHeight());
            };
            var windowResizeHandler = Y.one(window).on('resize', function(e) {
                resizePanel();
            });

            // panel creation reloads/refreshes the frame after DOM insertion: avoid re-POST
            var iframeNode = panelNode.one('iframe');
            iframeNode.set('src', config.contentUrl);
            resizePanel(); // must resize after setting iframe src

            mm_this._iframeNode = iframeNode;

            mm_this._titleNode = panelNode.one('.yui3-widget-hd > .title');

            if (config.print) {
                var printContainer = panelNode.one(printContainerSelector);
                var printButtonNode = printContainer ? printContainer.one('a') : null;
                printButtonNode && printButtonNode.on('click', printAction);
                mm_this._printButtonNode = printContainer;
            }

            if (helpUrl) {
                var helpLink = panelNode.one(helpContainerSelector + ' > a');
                helpLink && helpLink.on('click', helpAction);
            }

            var closeLink = panelNode.one(closeLinkSelector);
            closeLink && closeLink.on('click', function(e) { mm_this.closeModal(); });

            panel.on('visibleChange', function(e) {
                var hidden = !e.newVal; // e.newVal will be true when made visible, false when hidden
                if (hidden) {
                    if (mm_this._confirmCloseMessage) {
                        // If we need to show the confirm message, let the hide event run its course, then immediately show the panel again with the message
                        Y.later(0, null, function() {
                            panel.show();
                            if (confirm(mm_this._confirmCloseMessage)) {
                                mm_this._confirmCloseMessage = null;
                                panel.hide();
                            }
                        });
                    }
                    else {
                        windowResizeHandler.detach();
                        Y.later(0, null, function() {
                            maskNode.remove(true);
                            panel.destroy();
                        });
                    }
                }
            });

            panel.on('destroy', function(e) {
                // Show scrollbar in parent window
                Y.all('html').setStyle('overflow', 'auto');
                if (mm_this._onDestroy) {
                    windowResizeHandler.detach();
                    Y.later(0, null, function() {
                        mm_this._onDestroy();
                        mm_this._onDestroy = null;
                    });
                }
            });

            // Hide scrollbar in parent window
            Y.all('html').setStyle('overflow', 'hidden');

            panel.show();
            panel.blur();

            mm_this.setCurrentModal(panel);
            mm_this._opening_mutex = false;
        }
        ,
        closeModal: function() {
            var mm = this.getActiveModalManager();
            if (mm) {
                mm._modal.hide();
            }
        }
        ,
        // closeModalInParent is deprecated.  Use closeModal instead.
        closeModalInParent: function() {
            Y.log('closeModalInParent is deprecated');
            this.closeModal();
        }
        ,
        setConfirmCloseMessage: function(msg) { // Note: this can cause a race condition if used too soon after openModalUrl
            var mm = this.getActiveModalManager();
            if (mm) {
                mm._confirmCloseMessage = msg;
            }
        }
        ,
        displayErrorModal: function(errorMsg, callback) {
            var genericMsg = 'Your changes could not be saved.';
            errorMsg = errorMsg ? errorMsg : genericMsg;
    
            var config = {
                message: errorMsg,
                modalType: 'error',
                zIndex: 12 // need to increase from default value for MMND, see MX-2088
            };
    
            if (Mx.Util.isFunction(callback)) config.callback = callback;
    
            this.openModalAlert(config);
        }
        ,
        // the refresh code must be available in the main window
        // else IE might garbage collect it if the page in the modal changes
        refreshWindow: function () {
            this._window.location = this._window.location;
        }
        ,
        refreshWindowOnDestroy: function() { // Note: this can cause a race condition if used too soon after openModalUrl
            // refresh page if it does not use GET to post data
            // otherwise, some other approach may be needed
            var mm = this.getActiveModalManager();
            if (mm) {
                mm._onDestroy = mm.refreshWindow;
            }
        }
        ,
        // refreshParentOnDestroy is deprecated. Use refreshWindowOnDestroy instead.
        refreshParentOnDestroy: function() {
            Y.log('refreshParentOnDestroy is deprecated');
            this.refreshWindowOnDestroy();
        }
        ,
        redirectWindowOnDestroy: function(url) { // Note: this can cause a race condition if used too soon after openModalUrl
            var mm = this.getActiveModalManager();
            if (mm) {
                mm._onDestroy = function () { this._window.location = url; };
            }
        }
        ,
        getModalTitle: function() { // Note: this can cause a race condition if used too soon after openModalUrl
            var mm = this.getActiveModalManager();
            if (mm && mm._titleNode) {
                return mm._titleNode.get('text');
            }
        }
        ,
        setModalTitle: function(title, titleHover) { // Note: this can cause a race condition if used too soon after openModalUrl
            var mm = this.getActiveModalManager();
            if (mm && mm._titleNode) {
                mm._titleNode.set('text', Mx.Util.trunc(title, 80, true, true));
                if (titleHover) {
                    mm._titleNode.setAttribute('title', titleHover);
                }
            }
            // Also set title on iframe, for screen-readers
            if (mm && mm._iframeNode) {
                mm._iframeNode.setAttribute('title', title || titleHover || 'Modal Pop-up');
            }
        }
        ,
        showPrintButton: function(show) { // Note: this can cause a race condition if used too soon after openModalUrl
            var mm = this.getActiveModalManager();
            if (mm && mm._printButtonNode) {
                if (show) {
                    //mm._printButtonNode.setStyle('display','inline');
                    mm._printButtonNode.removeClass('invisible');
                } else {
                    mm._printButtonNode.addClass('invisible');
                }
            }
        }
    };

    Mx.Util.ModalManager = ModalManager;

}, '0.0.1', {
    requires: ['node', 'panel']
});

//
// Mx.Util.OverlayManager inline module definition
// Modified from 
// http://yui.github.io/yui2/docs/yui_2.2.2/docs/OverlayManager.js.html
// and 
// https://github.com/yui/yui3-gallery/blob/master/src/gallery-aui-overlay-manager/js/gallery-aui-overlay-manager.js
//
// Replace with YUI3 Y.OverlayManager when it becomes available

Mx.y.add('Mx.Util.OverlayManager', function(Y) {

    if (!Mx.Util) {
        throw new Error('Mx.Util.OverlayManager requires that Mx.Util have been loaded first.');
    }

    if (Mx.Util.OverlayManager) {
        return;
    }

    function OverlayManager() {
        this._overlays      = [];
        this._activeOverlay = null;
    }

    OverlayManager.prototype = {
        _setActive: function(overlay) {
            this._activeOverlay = overlay;
        }
        ,
        getActive: function() {
            return this._activeOverlay;
        }
        ,
        hideAll: function() {
            for (var o=0;o<this._overlays.length;o++) {
                this._overlays[o].hide();
			}
        }
        ,
        showAll: function() {
            for (var o=0;o<this._overlays.length;o++) {
                this._overlays[o].show();
			}
        }
        ,
        register: function(overlay) {
            var overlayMgr = this;
            if (overlay && overlay instanceof Array) {
                var regcount = 0;
                for (var o=0;o<overlay.length;o++) {
                    if (overlayMgr.register(overlay[o])) {
                        regcount++;
                    }
                }
                if (regcount > 0) {
                    return true;
                }
            } else if (overlay && overlay instanceof Object) {
                if (!this.find(overlay)) {
                    var zIndex = overlay.get('zIndex');
                    if (! isNaN(zIndex)) {
                        overlay.set('zIndex', parseInt(zIndex, 10));
                    } else {
                        overlay.set('zIndex', 0);
                    }
                    this._overlays.push(overlay);
                    var boundingBox = overlay.get('boundingBox');
                    overlay.on('destroy', overlayMgr._onOverlayDestroy, overlayMgr);
                    overlay.on('focusedChange', overlayMgr._onFocusedChange, overlayMgr);
                    boundingBox.on('mousedown', overlayMgr._onMouseDown, overlayMgr);
                }
                return true;
            } else {
                return false;
            }
        }
        ,
        _onOverlayDestroy: function(event) {
            var overlayMgr = this;
            if (event.newVal) {
                var overlay = event.currentTarget || event.target;
                if (overlay && overlayMgr.find(overlay)) {
                    overlayMgr.remove(overlay);
                }
            }
        }
        ,
        _onFocusedChange: function(event) {
            var overlayMgr = this;
            if (event.newVal) {
                var overlay = event.currentTarget || event.target;
                if (overlay && overlayMgr.find(overlay)) {
                    overlayMgr.focus(overlay);
                }
            }
        }
        ,
        _onMouseDown: function(event) {
            var overlayMgr = this;
            var overlay = Y.Widget.getByNode(event.currentTarget || event.target);
            if (overlay && overlayMgr.find(overlay)) {
                overlayMgr.focus(overlay);
            }
        }
        ,
        focus: function(overlay) {
            var activeOverlay = this.getActive();
            if (activeOverlay != overlay) {
                if (activeOverlay) {
                    activeOverlay.blur();
                }
                activeOverlay = overlay;
                this._setActive(overlay);
            }
            var overlays = this._overlays.sort(this.sortByZIndexDesc);
            var highest = overlays[0];
            if (highest !== activeOverlay) {
                var overlayZ = overlay.get('zIndex');
                var highestZ = highest.get('zIndex');
                overlay.set('zIndex', highestZ + 1);
                overlay.set('focused', true);
            }
        }
        ,
        find : function(overlay) {
            if (overlay instanceof Object) {
                for (var i=0;i<this._overlays.length;i++) {
                    if (this._overlays[i] == overlay) {
                        return this._overlays[i];
                    }
                }
            } else if (typeof overlay == "string") {
                for (var o=0;o<this._overlays.length;o++) {
                    if (this._overlays[o].id == overlay) {
                        return this._overlays[o];
                    }
                }
            }
            return null;
        }
        ,
        remove : function(overlay) {
            var overlayToRemove = this.find(overlay);
            if (overlayToRemove) {
                var originalZ = overlayToRemove.get('zIndex');
                overlayToRemove.set('zIndex', -1000);
                var overlays = this._overlays.sort(this.sortByZIndexDesc);
                this._overlays = overlays.slice(0, overlays.length-1);

                var boundingBox = overlay.get('boundingBox');
                overlayToRemove.detach('destroy', overlayMgr._onOverlayDestroy);
                overlayToRemove.detach('focusedChange', overlayMgr._onFocusedChange);
                boundingBox.detach('mousedown', overlayMgr._onMouseDown);
            }
        }
        ,
        sortByZIndexDesc: function(a, b) {
            if (!a || !b) {
                return 0;
            }
            else {
                var aZ = a.get('zIndex');
                var bZ = b.get('zIndex');

                if (aZ > bZ) {
                    return -1;
                } else if (aZ < bZ) {
                    return 1;
                } else {
                    return 0;
                }
            }
        }
        ,
        overlays: function() {
            return this._overlays;
        }
    };

    Mx.Util.OverlayManager = OverlayManager;

});

/******************************************************************************/

//
// common domready initialization
//

Mx.yui.inst().use('node', 'Mx.Util', 'Mx.Util.ModalManager', 'Mx.Util.OverlayManager', function(Y) {

    // Prime Mx.Util and create the singleton Mx.Util.ModalManager to be shared.
    // iframes within modals can close themselves with this:
    //   Mx.modalManager.closeModal();

    Mx.modalManager = new Mx.Util.ModalManager();
    Mx.overlayManager = new Mx.Util.OverlayManager();

    // The more-info-popup class marks bits of content that have context
    // sensitive help.

    function setupMoreInfoPopups() {
        var mip_nodes = Y.all('.more-info-popup');
        if (mip_nodes) {
            Y.use('Mx.MoreInfoPopup', function(Y) {
                mip_nodes.each(function(mip_node) {
                    var mip = new Mx.MoreInfoPopup({
                        contentBox: mip_node,
                        activate: 'click'
                    });
                    mip.render();
                    Mx.getOverlayManager().register(mip.get('popupPanel'));
                });
            });
        }
    }

    // Some links render in a modal panel iframe container
    function setupModalPanels() {
        var links = Y.all('a.in-modal-panel');
        if (links) {
            links.each(function (link) {
                link.on('click', function(e) {
                    e.preventDefault();
                    Mx.modalManager.openModalUrl({
                        title: link.get('text'),
                        contentUrl: e.target.getAttribute('href')
                    });
                });
                link.removeClass('invisible');
            });
        }
    }

    function setupPopupWindows() {
        var links = Y.all('a.in-popup-window');
        if (links) {
            links.each(function (link) {
                link.on('click', function(e) {
                    e.preventDefault();
                    Mx.PopupWindow.openPopupUrl({
                        contentUrl: e.target.getAttribute('href')
                    });
                });
                link.removeClass('invisible');
            });
        }
    }

    // Do all the link tricks after everything has loaded
    var setupLinkTricks = function () {
        setupMoreInfoPopups();
        setupModalPanels();
        setupPopupWindows();
    };

    Y.on('domready', setupLinkTricks);

});

/******************************************************************************/

/*
END Mx.js
*/
o;N      XqXq=wr?X   P    :https://session.masteringengineering.com/assets/ui/js/app/Mx.build1701051538.js necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAAA3nMIIN4zCCDMugAwIBAgIQK6lFdLvDbujzVgmtjxn3TDANBgkqhkiG9w0BAQsFADCBljELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UEBxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxPDA6BgNVBAMTM0NPTU9ETyBSU0EgT3JnYW5pemF0aW9uIFZhbGlkYXRpb24gU2VjdXJlIFNlcnZlciBDQTAeFw0xNjA5MDgwMDAwMDBaFw0xODA5MDgyMzU5NTlaMIHlMQswCQYDVQQGEwJHQjERMA8GA1UEERMIV0MyUiAwUkwxDzANBgNVBAgTBkxvbmRvbjEPMA0GA1UEBxMGTG9uZG9uMRIwEAYDVQQJEwk4MCBTdHJhbmQxFDASBgNVBAoTC1BlYXJzb24gUExDMRcwFQYDVQQLEw5FbnRlcnByaXNlIFNTTDEgMB4GA1UECxMXSG9zdGVkIGJ5IFBlYXJzb24sIEluYy4xGTAXBgNVBAsTEE11bHRpLURvbWFpbiBTU0wxITAfBgNVBAMTGG1hc3RlcmluZy5wZWFyc29uY21nLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBANHGZaUS+dVKdyqj6bLiruLcZv07DaggTLkGJ+WQv5gDY33lPvZ5hSqPUGOJg3kFs1UNoUbUo6u27CBCAl+I5PA9lR3jv3aIKoo5nF26Ot6JHFnb0LzCIBPs+gV5A8GpGcrK0M7Rn6k/3mDBbhvLWrBWW/SfQEWILldwHM2E9hrwmVPu+P6WHC2rUJRgEz2KgXL2/5I68q1z/tolxV84ejZprgREJ2Ydx/uuFTQBg+rcWKhF0wfMD048qHUfaSCtiv0P/uuh1mW5Of/EylZtZhqiVAUP+jqPFnW8BtaK1HmQ+0TP2tsUHziBZEt2OAQF1Acmuzs3qHm22sXqxUTep0MCAwEAAaOCCdowggnWMB8GA1UdIwQYMBaAFJrzK9rPrU+2L7sqSEgqErcbQsEkMB0GA1UdDgQWBBSVlTKQJ3kv33EEDBSi5V9K3ZOiMDAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwUAYDVR0gBEkwRzA7BgwrBgEEAbIxAQIBAwQwKzApBggrBgEFBQcCARYdaHR0cHM6Ly9zZWN1cmUuY29tb2RvLmNvbS9DUFMwCAYGZ4EMAQICMFoGA1UdHwRTMFEwT6BNoEuGSWh0dHA6Ly9jcmwuY29tb2RvY2EuY29tL0NPTU9ET1JTQU9yZ2FuaXphdGlvblZhbGlkYXRpb25TZWN1cmVTZXJ2ZXJDQS5jcmwwgYsGCCsGAQUFBwEBBH8wfTBVBggrBgEFBQcwAoZJaHR0cDovL2NydC5jb21vZG9jYS5jb20vQ09NT0RPUlNBT3JnYW5pemF0aW9uVmFsaWRhdGlvblNlY3VyZVNlcnZlckNBLmNydDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMIIIGQYDVR0RBIIIEDCCCAyCGG1hc3RlcmluZy5wZWFyc29uY21nLmNvbYIcYWlzLm1hc3RlcmluZy5wZWFyc29uY21nLmNvbYIcYXBpLm1hc3RlcmluZy5wZWFyc29uY21nLmNvbYIdYXV0aC5tYXN0ZXJpbmcucGVhcnNvbmNtZy5jb22CH2F1dGhvci5tYXN0ZXJpbmcucGVhcnNvbmNtZy5jb22CI2NvbnRlbnRhcHAubWFzdGVyaW5nLnBlYXJzb25jbWcuY29tgidjb250ZW50c2VydmljZS5tYXN0ZXJpbmcucGVhcnNvbmNtZy5jb22CH2dpbW1pZS5tYXN0ZXJpbmcucGVhcnNvbmNtZy5jb22CIWl0ZW1lZGl0Lm1hc3RlcmluZy5wZWFyc29uY21nLmNvbYISbWFzdGVyaW5nYWFuZHAuY29tghJtYXN0ZXJpbmdhc3Ryby5jb22CFm1hc3RlcmluZ2FzdHJvbm9teS5jb22CEG1hc3RlcmluZ2Jpby5jb22CFG1hc3RlcmluZ2Jpb2xvZ3kuY29tghZtYXN0ZXJpbmdjaGVtaXN0cnkuY29tghttYXN0ZXJpbmdjb2xsZWdlcGh5c2ljcy5jb22CGG1hc3RlcmluZ2VuZ2luZWVyaW5nLmNvbYIhbWFzdGVyaW5nZW52aXJvbm1lbnRhbHNjaWVuY2UuY29tghRtYXN0ZXJpbmdnZW5jaGVtLmNvbYIVbWFzdGVyaW5nZ2VuZXRpY3MuY29tghZtYXN0ZXJpbmdnZW9ncmFwaHkuY29tghRtYXN0ZXJpbmdnZW9sb2d5LmNvbYIfbWFzdGVyaW5naGVhbHRoYW5kbnV0cml0aW9uLmNvbYIYbWFzdGVyaW5nbWV0ZW9yb2xvZ3kuY29tghltYXN0ZXJpbmdtaWNyb2Jpb2xvZ3kuY29tgh5tYXN0ZXJpbmdudXRyaXRpb24ucGVhcnNvbi5jb22CGW1hc3RlcmluZ29jZWFub2dyYXBoeS5jb22CFG1hc3RlcmluZ3BoeXNpY3MuY29tgiBteGVhbW9uLm1hc3RlcmluZy5wZWFyc29uY21nLmNvbYIgbXhsY21vbi5tYXN0ZXJpbmcucGVhcnNvbmNtZy5jb22CJnJlZGlyZWN0LnByb2QubWFzdGVyaW5nLnBlYXJzb25jbWcuY29tghpzZXNzaW9uLm1hc3RlcmluZ2FhbmRwLmNvbYIac2Vzc2lvbi5tYXN0ZXJpbmdhc3Ryby5jb22CHnNlc3Npb24ubWFzdGVyaW5nYXN0cm9ub215LmNvbYIYc2Vzc2lvbi5tYXN0ZXJpbmdiaW8uY29tghxzZXNzaW9uLm1hc3RlcmluZ2Jpb2xvZ3kuY29tgh5zZXNzaW9uLm1hc3RlcmluZ2NoZW1pc3RyeS5jb22CI3Nlc3Npb24ubWFzdGVyaW5nY29sbGVnZXBoeXNpY3MuY29tgiBzZXNzaW9uLm1hc3RlcmluZ2VuZ2luZWVyaW5nLmNvbYIpc2Vzc2lvbi5tYXN0ZXJpbmdlbnZpcm9ubWVudGFsc2NpZW5jZS5jb22CHHNlc3Npb24ubWFzdGVyaW5nZ2VuY2hlbS5jb22CHXNlc3Npb24ubWFzdGVyaW5nZ2VuZXRpY3MuY29tgh5zZXNzaW9uLm1hc3RlcmluZ2dlb2dyYXBoeS5jb22CHHNlc3Npb24ubWFzdGVyaW5nZ2VvbG9neS5jb22CJ3Nlc3Npb24ubWFzdGVyaW5naGVhbHRoYW5kbnV0cml0aW9uLmNvbYIgc2Vzc2lvbi5tYXN0ZXJpbmdtZXRlb3JvbG9neS5jb22CIXNlc3Npb24ubWFzdGVyaW5nbWljcm9iaW9sb2d5LmNvbYImc2Vzc2lvbi5tYXN0ZXJpbmdudXRyaXRpb24ucGVhcnNvbi5jb22CIXNlc3Npb24ubWFzdGVyaW5nb2NlYW5vZ3JhcGh5LmNvbYIcc2Vzc2lvbi5tYXN0ZXJpbmdwaHlzaWNzLmNvbYIWd3d3Lm1hc3RlcmluZ2FhbmRwLmNvbYIWd3d3Lm1hc3RlcmluZ2FzdHJvLmNvbYIad3d3Lm1hc3RlcmluZ2FzdHJvbm9teS5jb22CFHd3dy5tYXN0ZXJpbmdiaW8uY29tghh3d3cubWFzdGVyaW5nYmlvbG9neS5jb22CGnd3dy5tYXN0ZXJpbmdjaGVtaXN0cnkuY29tgh93d3cubWFzdGVyaW5nY29sbGVnZXBoeXNpY3MuY29tghx3d3cubWFzdGVyaW5nZW5naW5lZXJpbmcuY29tgiV3d3cubWFzdGVyaW5nZW52aXJvbm1lbnRhbHNjaWVuY2UuY29tghh3d3cubWFzdGVyaW5nZ2VuY2hlbS5jb22CGXd3dy5tYXN0ZXJpbmdnZW5ldGljcy5jb22CGnd3dy5tYXN0ZXJpbmdnZW9ncmFwaHkuY29tghh3d3cubWFzdGVyaW5nZ2VvbG9neS5jb22CI3d3dy5tYXN0ZXJpbmdoZWFsdGhhbmRudXRyaXRpb24uY29tghx3d3cubWFzdGVyaW5nbWV0ZW9yb2xvZ3kuY29tgh13d3cubWFzdGVyaW5nbWljcm9iaW9sb2d5LmNvbYIid3d3Lm1hc3RlcmluZ251dHJpdGlvbi5wZWFyc29uLmNvbYIdd3d3Lm1hc3RlcmluZ29jZWFub2dyYXBoeS5jb22CGHd3dy5tYXN0ZXJpbmdwaHlzaWNzLmNvbTANBgkqhkiG9w0BAQsFAAOCAQEABHKDE+n4VU4Ltrb9uL5aLCwBOqbMMpSUZXZup2+jViZqukfanoapjDeB6oKVEjVl3jYmRaxRIZBIbC91vskQAirK9YWqNEGk5FLtLeYwrc38/w2NkSn8I/ML3xpP6/GbgH2T6IpSPr67LE5mJqgz+RaBOnt/O0FVsHUsqBr4lxsuYDNuQXEAP4yRuxXD4hZ7On13YnnowfcAja/3YmvmxIKMZDwlwl2Elmi6VMFG6L4MryCIPydeFZDnPwgjyXsBTeXd+D9xG6IVMcNKHCm2G3rUwqUd0v6NA6zeuOseHG4P13NZF3+QT1VJo1Ow/oSOrqrNgv9V2ftCQfVEZ+fUsQAvAAMAAAAAAQEAAA== request-method GET response-head HTTP/1.1 200 OK
Date: Wed, 22 Feb 2017 11:09:11 GMT
Server: Apache
Last-Modified: Thu, 05 Jan 2017 15:38:14 GMT
Etag: "47ae028-17062-5455ab083f17e"
Accept-Ranges: bytes
Content-Length: 94306
Content-Type: application/javascript
 original-response-headers Date: Wed, 22 Feb 2017 11:09:11 GMT
Server: Apache
Last-Modified: Thu, 05 Jan 2017 15:38:14 GMT
Etag: "47ae028-17062-5455ab083f17e"
Accept-Ranges: bytes
Content-Length: 94306
Keep-Alive: timeout=1, max=50
Connection: Keep-Alive
Content-Type: application/javascript
 uncompressed-len 0  pb