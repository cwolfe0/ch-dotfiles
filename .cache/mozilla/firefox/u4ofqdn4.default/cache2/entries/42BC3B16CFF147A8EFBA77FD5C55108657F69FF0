var localjson = null;
function clearLocalJson() {
	localjson = null;
}
setInterval(clearLocalJson,900000);

jQuery(function($){
	
	$( "#dialog-message" ).dialog({
		 resizable: false,
		 height:170,
		 modal: true,
		 autoOpen: false
	});
	
	$( "#dialog-gettingassignments-message" ).dialog({
		 resizable: false,
		 height:170,
		 modal: true,
		 autoOpen: false
	});
	
	$( "#dialog-sortingitems-message" ).dialog({
		 resizable: false,
		 height:170,
		 modal: true,
		 autoOpen: false
	});
	
	$('.hldr-nav-tools').on('click', function (event){
		event.preventDefault();
		$('.hldr-diagnostics').hide();
		$('.hldr-grades').hide();
		$('.hldr-tools').show();
	});
	
	$('.hldr-nav-diagnostics').on('click', function (event){
		event.preventDefault();
		$('.hldr-tools').hide();
		$('.hldr-grades').hide();
		$('.hldr-diagnostics').show();		
	});
	
	$('.close-success-sync').on('click', function (event){
		event.preventDefault();
			$("#gradesync-success").hide();
		
	});
	
	$('.close-alert-sync').on('click', function (event){
		event.preventDefault();
		$("#gradesync-error").hide();
		$("#gradesync-error-description").empty();
		$("#gradesync-error-heading").empty();	
	});
	
	$('.close-success-sync').on('click', function (event){
		event.preventDefault();
		$("#gradesync-success").hide();
		$("#gradesync-success-items").empty();		
	});

	function loadAllItems(event){
		event.preventDefault();
		$("#gradesync-error").hide();
		$('.hldr-tools').hide();
		$('.hldr-diagnostics').hide();
		//$("#gradesync-lmsaccess-error").empty();
		$('.hldr-grades').show();

		/*TPLMS-3532*/

		var GDCSettings = "";
		$.ajax({
			cache: false,
			url : '/highlander/api/v1/gdc/settings/',
			type : "GET",
			contentType : "application/json;charset=utf-8",
			success : function(json) {
				GDCSettings = json;

				if(isAutoSync){
					if(GDCSettings.isLoaded){
						if (GDCSettings.autoSync) {
							$('.syncGrades').find(':radio[name=grades][value="Yes"]').prop('checked', true);
							$('.syncGrades').find(':radio[name=grades][value="No"]').prop('checked', false);

							if (GDCSettings.syncAll) {
								$(".select-allitems-cb").prop("checked", true);
							}
							else {
								$(".select-allitems-cb").prop("checked", false);
							}

						} else {
							$('.syncGrades').find(':radio[name=grades][value="Yes"]').prop('checked', false);
							$('.syncGrades').find(':radio[name=grades][value="No"]').prop('checked', true);
						}


					}
					else {
						$('.syncGrades').find(':radio[name=grades][value="No"]').prop('checked', false);
						$(".select-allitems-cb").prop("checked", false);
					}
				}
				fetchItems(GDCSettings);
			},
			error: function (xhr, ajaxOptions, thrownError) {
				fetchItems(GDCSettings);
			}
		});

		function fetchItems(GDCSettings) {
			if (!localjson) {

				//disallow them from clicking
				$('.hldr-nav-grades').click(false);

				//TODO: Should we put in a 1 second delay on this, so the dialog doesn't just blip
				$('#dialog-gettingassignments-message').dialog("open");
				$("body").css("cursor", "progress");

				$('#items > tr').remove();
				$.ajax({
					cache: false,
					url : '/highlander/api/v1/items/'+external_course_id + "?consumerkey="+consumer_key,
					type : "GET",
					contentType : "application/json;charset=utf-8",
					success : function(json) {
						localjson = json;
						//allow them to click again :)
						$('.hldr-nav-grades').click(true);
						$('#dialog-gettingassignments-message').dialog("close");
						$("body").css("cursor", "default");

						$.each(json, function (i,v) {

							var html = "<tr>";

							/*TPLMS-3532*/

							if(isAutoSync){
								if(GDCSettings.isLoaded && GDCSettings.autoSync){
									if(GDCSettings.syncAll){
										html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" checked data-itemid=\"" + v.id + "\" name=\"linkids\" value=\"" + v.id + "\"></td>";
									}
									else{
										var isEnabled = false;
										$.each(GDCSettings.items, function (j, u) {
											if (v.id == u) {
												isEnabled = true;
											}
										});

										if (isEnabled) {
											if ($('input[name=grades]').filter(':checked').val()=='No'){
												html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" data-itemid=\"" + v.id + "\" name=\"linkids\" value=\"" + v.id + "\"></td>";
											}
											else if($('input[name=grades]').filter(':checked').val()=='Yes'){
												html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" checked data-itemid=\"" + v.id + "\" name=\"linkids\" value=\"" + v.id + "\"></td>";
											}
										}
										else {
											html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" data-itemid=\"" + v.id + "\" name=\"linkids\" value=\"" + v.id + "\"></td>";
										}
									}
								}
								else{
									html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" data-itemid=\""+v.id+"\" name=\"linkids\" value=\""+v.id+"\"></td>";
								}
							}
							else{
								html = html + "<td><input class=\"chkbox-grade-item\" type=\"checkbox\" data-itemid=\""+v.id+"\" name=\"linkids\" value=\""+v.id+"\"></td>";
							}


							html = html + "<td data-itemid='"+v.id+"'>"+v.title;
							html = html + "</td>";
							html = html + "</tr>";
							$('#items > tbody:last').append(html);
							$('#items').show();
						});

						//Bind the Table Sorter, for information, see: http://tablesorter.com/
						$("#items").tablesorter( {headers: { 0: { sorter: false}}});
						$("#items").bind("sortStart",function() {
							$('#dialog-sortingitems-message').dialog("open");
							$("body").css("cursor", "progress");
						}).bind("sortEnd",function() {
							$('#dialog-sortingitems-message').dialog("close");
							$("body").css("cursor", "default");
						});

					},
					error: function (xhr, ajaxOptions, thrownError) {

						//allow them to click again
						$('.hldr-nav-grades').click(true);
						$('#dialog-gettingassignments-message').dialog("close");
						$("body").css("cursor", "default");

						$('#gradesync-error-heading').text('Notice');

						//in case there is already stuff here, empty it
						$('#gradesync-error-description').empty();

						$('#gradesync-error-description').append('We could not find any Pearson MyLab & Mastering assignments to sync with your course.  Please check to make sure you have set up your Pearson MyLab & Mastering course settings to <a href="http://www.pearsonhighered.com/mlm/lms-help-for-educators/" target=_blank>sync grades</a>.');
						$('#gradesync-error-description').append('<br/><br/>Your MyLab & Mastering course may not support syncing grades.');
						$('#gradesync-error-description').append('<br/><br/>Please contact Pearson\'s 24/7 <a href="http://247pearsoned.custhelp.com/" target=_blank>Help Desk</a> if you continue to receive this error.');
						$('#gradesync-error').show();
						$('#items').hide();
					}
				});
			}
		}


	}
	
	$('.hldr-nav-grades').on('click', function (event){
		loadAllItems(event);
	});

	$.ajax({
		cache: false,
		url : "/highlander/api/v2/bundles/"+product+"?restrict=tools&consumer="+consumer_id,
		type : "GET",
		contentType : "application/json;charset=utf-8",
		success : function(result) {
			
			var platform = result.platform;
			var description = result.basicLtiLinkBundle.description;
			
			if (product != 'unmapped') {
				if (platform == null) {
					platform = 'Course Tools';
				}
				
				if (description == null) {
					description = 'Use the links below to access your MyLab and Mastering course.';
				}
				$('#support-links-toggle-container').show();
			}
			else {
				if (platform == null) {
					platform = 'Welcome '+user_firstname;
				}
				
				if (description == null) {
					description = 'Use the links below to access and manage MyLab and Mastering products for this course through '+ consumer_name +'.';
				}
			}
			
			$('#tools-title').text(platform);
			$('#tools-description').text(description);
			var i = $("#instlinks");
			var s = $("#studlinks");
			$.each(result.basicLtiLinkBundle.links, function() {
				var io = null;
				$.each(this.extensions, function() {
					$.each(this.parameters, function() {
						if(this.name == 'isinstructoronly') {
							io = this.value;
						}
					});
				});
				
				var id = this.id;
				var h = '<a href="javascript:launch(\''+id+'\')">'+this.title+'</a>';
				if (io == 'true') {
					if (is_instructor == 'true') {
						i.append($("<h3/>", {html:h})).append($("<p/>", {html:this.description}));
					}
				}
				else {
					s.append($("<h3/>", {html:h})).append($("<p/>", {html:this.description}));
				}
			});
		},
		error : function (xhr, ajaxOptions, thrownError) {
			$('#tools-error-heading').text('An error occurred');
			$('#tools-error-description').text('Unable to access the links for your course.');
			$('#tools-error').show();
		}
	});
	
	var support_links_toggled = 0;
	$('#support-links-toggle').on('click',
			function (event) {
				event.preventDefault();
				$('#support-links-container').toggle(
					function () {
						if (support_links_toggled == 0) {
							$.ajax({	
								cache: false,
								url : "/highlander/api/v2/bundles/"+product+"?restrict=support_tools&consumer="+consumer_id,
								type : "GET",
								contentType : "application/json;charset=utf-8",
								success : function(result) {
									var i = $("#instsupportlinks");
									var s = $("#studsupportlinks");
									var support_links_count = 0;
									$.each(result.basicLtiLinkBundle.links, function() {
										support_links_count++;
										var io = null;
										$.each(this.extensions, function() {
											$.each(this.parameters, function() {
												if(this.name == 'isinstructoronly') {
													io = this.value;
												}
											});
										});
										
										var id = this.id;
										var h = '<a href="javascript:launch(\''+id+'\')">'+this.title+'</a>';
										if (io == 'true') {
											if (is_instructor == 'true') {
												i.append($("<h3/>", {html:h})).append($("<p/>", {html:this.description}));
											}
										}
										else {
											s.append($("<h3/>", {html:h})).append($("<p/>", {html:this.description}));
										}
									});
									support_links_toggled = 1;
								},
								error : function (xhr, ajaxOptions, thrownError) {
									$('#supporttools-error-heading').text('An error occurred');
									$('#supporttools-error-description').text('Unable to access the support links for your course.');
									$('#supporttools-error').show();
								}
							});
						}
					}		
				);
			}
		);
});
3&ÂB7      X­q!X­q"=wpÂX¶«¡   N    :https://tpi.bb.pearsoncmg.com/highlander/resources/js/highlander/tools.js?v=4 necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAABBNMIIQSTCCDzGgAwIBAgIQOQxDJmqS3H9+1ztLBatN2TANBgkqhkiG9w0BAQsFADCBljELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UEBxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxPDA6BgNVBAMTM0NPTU9ETyBSU0EgT3JnYW5pemF0aW9uIFZhbGlkYXRpb24gU2VjdXJlIFNlcnZlciBDQTAeFw0xNjAzMjMwMDAwMDBaFw0xODAzMjMyMzU5NTlaMIGyMQswCQYDVQQGEwJHQjERMA8GA1UEERMIV0MyUiAwUkwxDzANBgNVBAgTBkxvbmRvbjEPMA0GA1UEBxMGTG9uZG9uMRQwEgYDVQQKEwtQZWFyc29uIFBMQzEgMB4GA1UECxMXSG9zdGVkIGJ5IFBlYXJzb24sIEluYy4xGTAXBgNVBAsTEE11bHRpLURvbWFpbiBTU0wxGzAZBgNVBAMTEnd3dy5wZWFyc29uY21nLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAO9ZkT6RdfiqcVJejUxhXQKSwSvO+SP7t3P1kJsyNmN2e/o0sLkBVYHpP3eq0gRa3cZQ1Qcfzy6FlcyTMRlKfv6LSEhsW1V7PSgqSNrpY4+YsqMa6c+lzshaZPzyO80TtqCcxoK5v9bQyWENdlhSzLRW6Gu9bytBERrZoCOmowUIVBxRnmBkrPMhGiNbIiv6OcZ+Y2v/ebv6dsA6qZQwhhn7XIF16Kp8jhJgEu0m4yp3efu2HV2bjK7MJjdws1LyDET1Fby7Rcl24NPQfu9RXb1XmGV9BHzErvqtvczhoTNhGc8JEfltmsPIiJV0wZfhVq4jzx0a6GXJSnRzfxpYORsCAwEAAaOCDHMwggxvMB8GA1UdIwQYMBaAFJrzK9rPrU+2L7sqSEgqErcbQsEkMB0GA1UdDgQWBBRD0N1d6T3ABcsEEzx9oi7+0fuZszAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwUAYDVR0gBEkwRzA7BgwrBgEEAbIxAQIBAwQwKzApBggrBgEFBQcCARYdaHR0cHM6Ly9zZWN1cmUuY29tb2RvLmNvbS9DUFMwCAYGZ4EMAQICMFoGA1UdHwRTMFEwT6BNoEuGSWh0dHA6Ly9jcmwuY29tb2RvY2EuY29tL0NPTU9ET1JTQU9yZ2FuaXphdGlvblZhbGlkYXRpb25TZWN1cmVTZXJ2ZXJDQS5jcmwwgYsGCCsGAQUFBwEBBH8wfTBVBggrBgEFBQcwAoZJaHR0cDovL2NydC5jb21vZG9jYS5jb20vQ09NT0RPUlNBT3JnYW5pemF0aW9uVmFsaWRhdGlvblNlY3VyZVNlcnZlckNBLmNydDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMIIKsgYDVR0RBIIKqTCCCqWCEnd3dy5wZWFyc29uY21nLmNvbYIhYXBpLnZpZXcuZWJvb2twbHVzLnBlYXJzb25jbWcuY29tggxhcmlzZXMycy5jb22CDGFyaXNlczJzLm5ldIIaYjJiLnJlZ2lzdGVyLm15cGVhcnNvbi5jb22CGmIyYy5yZWdpc3Rlci5teXBlYXJzb24uY29tgiNicmlkZ2V0b29scy5kZXZvcHMwMS5wZWFyc29uY21nLmNvbYIjYnJpZGdldG9vbHMuZGV2b3BzMDIucGVhcnNvbmNtZy5jb22CLWNkbi1odHRwLW9yaWdpbi5saXZlLm1lZGlhLnBwZS5wZWFyc29uY21nLmNvbYIXY2VydC5hcGkucGVhcnNvbmNtZy5jb22CHGNlcnQuaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CHmNlcnQubWVkaWFzaGFyZS5wZWFyc29uY21nLmNvbYIYY2VydDEucHdjLnBlYXJzb25jbWcuY29tgitjdXJyaWN1bHVtLm1lZGlhLWh0dHAtb3JpZ2luLnBlYXJzb25jbWcuY29tghZkZXYuYXBpLnBlYXJzb25jbWcuY29tghtkZXYucXVhZG5leHQucGVhcnNvbmNtZy5jb22CGmRldi5zb2Euc2d3LnBlYXJzb25jbWcuY29tghpncmFkZWl0LnBwZS5wZWFyc29uY21nLmNvbYIjaGVkLndzLm15bGFicy5weC5wcGUucGVhcnNvbmNtZy5jb22CJGhlcmVnaXN0ZXIucnVtYmEuZGVtby5wZWFyc29uY21nLmNvbYIjaGVyZWdpc3Rlci5ydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CI2hlcmVnaXN0ZXIucnVtYmEucHBlLnBlYXJzb25jbWcuY29tghppbnQuc29hLnNndy5wZWFyc29uY21nLmNvbYIXaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CI2sxMnJlcG9ydGluZy5pbnQuYXBpLnBlYXJzb25jbWcuY29tgiRrMTJyZXBvcnRpbmcudGVzdC5hcGkucGVhcnNvbmNtZy5jb22CHWxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgiBtZWRpYS1odHRwLW9yaWdpbi5wZWFyc29uY21nLmNvbYIabWVkaWFwbGF5ZXIucGVhcnNvbmNtZy5jb22CIm12Yy1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CIm12bC1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CIm12dC1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHG15bGFicy5weC5wcGUucGVhcnNvbmNtZy5jb22CGm9ic2VydmF0aW9ucy5zY2hvb2xuZXQuY29tgiJvcGVuLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgh5wY3QuZ3JhZGVpdC5wcGUucGVhcnNvbmNtZy5jb22CGHBlYXJzb25jb3Jlc3RhbmRhcmRzLmNvbYIQcGVhcnNvbnRleGFzLmNvbYIXcGVyZi5hcGkucGVhcnNvbmNtZy5jb22CHHBlcmYuaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYxLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYyLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYzLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY0LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY1LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY2LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CEnBldC5wZWFyc29uY21nLmNvbYIfcGxheWVyLm1lZGlhLnBwZS5wZWFyc29uY21nLmNvbYIlcGxheWVyLm1lZGlhLnByb2QtdGVzdC5wZWFyc29uY21nLmNvbYIgcGxheWVyLm1lZGlhLnByb2QucGVhcnNvbmNtZy5jb22CFnBwZS5wZXQucGVhcnNvbmNtZy5jb22CFnBwZS5waWEucGVhcnNvbmNtZy5jb22CFnBwZS5wd2MucGVhcnNvbmNtZy5jb22CGnBwZS5zb2Euc2d3LnBlYXJzb25jbWcuY29tghtwcm9kLnNvYS5zZ3cucGVhcnNvbmNtZy5jb22CG3Byb3NwZXJvLmludC5wZWFyc29uY21nLmNvbYIScHdjLnBlYXJzb25jbWcuY29tghpxYS5xdWFkbmV4dC5wZWFyc29uY21nLmNvbYIUcmFkbWluLm15cGVhcnNvbi5jb22CHnJhZG1pbi5ydW1iYWRldi5wZWFyc29uY21nLmNvbYIfcmFkbWluLnJ1bWJhdGVzdC5wZWFyc29uY21nLmNvbYIWcmVnaXN0ZXIubXlwZWFyc29uLmNvbYImcmVnaXN0cmF0aW9uLnJ1bWJhLmRlbW8ucGVhcnNvbmNtZy5jb22CJXJlZ2lzdHJhdGlvbi5ydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CL3J1bWJhLWh0dHAtb3JpZ2luLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tghlydW1iYS5kZW1vLnBlYXJzb25jbWcuY29tghhydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CFHJ1bWJhLnBlYXJzb25jbWcuY29tgh9zZWN1cmUucnVtYmEuaW50LnBlYXJzb25jbWcuY29tghRzaWduaW4ubXlwZWFyc29uLmNvbYIfc2ltNS5wcGUucGVnYXN1cy5wZWFyc29uY21nLmNvbYIhc21zLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgh1zc28ucnVtYmEuZGVtby5wZWFyc29uY21nLmNvbYIcc3NvLnJ1bWJhLmludC5wZWFyc29uY21nLmNvbYIYc3NvLnJ1bWJhLnBlYXJzb25jbWcuY29tghxzc28ucnVtYmEucHBlLnBlYXJzb25jbWcuY29tghhzdGFnZS5hcGkucGVhcnNvbmNtZy5jb22CHHN0YWdlLnNvYS5zZ3cucGVhcnNvbmNtZy5jb22CIXN0YWdpbmcubWVkaWFzaGFyZS5wZWFyc29uY21nLmNvbYIbc3RnLnF1YWRuZXh0LnBlYXJzb25jbWcuY29tghV0cGkuYmIucGVhcnNvbmNtZy5jb22CHXVzZXIucnVtYmEuaW50LnBlYXJzb25jbWcuY29tghl1c2VyLnJ1bWJhLnBlYXJzb25jbWcuY29tgh52Y2hpbGQucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHXZpZXcuZWJvb2twbHVzLnBlYXJzb25jbWcuY29tgh92aWV3LmV0ZXh0LmhvbWUyLnBlYXJzb25jbWcuY29tgh12bGlmZS5wcGUxLm12eC5wZWFyc29uY21nLmNvbYIddnRlZW4ucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHHd3dy5wZWFyc29uY29yZXN0YW5kYXJkcy5jb22CFHd3dy5wZWFyc29udGV4YXMuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAtt5duenveup5NPZzyrLSw2fChmekdRvmTfdfAZF/trK54oJyKxsGI3t6CYWonfZIdE1q9cOr167wrlPEByHZImLIz+suZaNZKdHYMwp9dhnNoxqfcGkUaP5SXAE+hDe20kNAUfnvH3TEqve3DmWlBdyourD4U5GZeEgHDuEFhp25O53w9zGa5CQbAB1mnO0rXbJZ4B08EhZdQSxDC95S1MG62/HxP0CU55EQIVvjh8eSCRq4lDCyajB4YFNNmB+rI7nSAk5JWktEbwN8JNXNtv6KAMGD65T0Eoj6xUEPdTobBs9JiChQ21ctvpGyjwD8RBPAS89DX6tEMxHJMYKddAC8AAwAAAAABAQAA request-method GET response-head HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Last-Modified: Mon, 28 Nov 2016 21:10:18 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 10705
Date: Wed, 22 Feb 2017 11:08:19 GMT
 original-response-headers Server: Apache-Coyote/1.1
Last-Modified: Mon, 28 Nov 2016 21:10:18 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 10705
Date: Wed, 22 Feb 2017 11:08:19 GMT
 uncompressed-len 0   )Ñ