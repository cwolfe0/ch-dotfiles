
//count of items
var returned_items=0;
var error_items=0;
var sent_items=0;

function push(item_id) {
	$("#dialog-message").dialog( "open" );
	//Send isStandardCourse as a part of request body to disable deep link feature for custom integration
	var postObject = {"itemid":item_id, "isStandardCourse":isStandardCourse};
	$.ajax({
		url : '/highlander/api/v1/items',
		type : 'POST',
		data : JSON.stringify(postObject),
		contentType : "application/json;charset=utf-8",
		success : function(response) {
			
			$("#gradesync-success-items").append("<p>&nbsp;" + $("td[data-itemid='" + item_id +"']").text()+ '</p>');
			$("#gradesync-success").show();//.delay(30000).fadeOut(removeSuccessfullySyncd);


			//up the count of responses			
			returned_items = returned_items + 1;
			

			
			//cleanup			
			checkAndCleanupBatchOfRequests();
		},
		error: function (xhr, ajaxOptions, thrownError) {
			var jsonResponse = JSON.parse(xhr.responseText);
			
			$("#gradesync-error-description").append('<p>Unable to sync item: '+$("td[data-itemid='" + item_id +"']").text()+ ' <br/>&nbsp;' + jsonResponse.error + '</p></br>');
			$("#gradesync-error").show();//.delay(30000).fadeOut(removeErrorsSyncd);

			//up the count of responses
			error_items = error_items + 1;
			
			//cleanup
			checkAndCleanupBatchOfRequests();
		}
	});
}

function checkAndCleanupBatchOfRequests() {
			
	if (returned_items+error_items==sent_items) {	
		$("#number-of-items").html(returned_items + " of " + sent_items + " have completed.");
			
		//first, reset them
		returned_items=0;
		sent_items=0;
		error_items=0;
		
		//second, reset the cursor
		$("body").css("cursor", "default");
		
		//close the dialog
		$("#dialog-message").dialog("close");		
		$("#number-of-items").empty();		
		
		if (error_items > 0) {
			$("#gradesync-error").show().delay(30000).fadeOut(removeErrorsSyncd);
		}
		if (returned_items > 0){
			$("#gradesync-success").show().delay(30000).fadeOut(removeSuccessfullySyncd);
		}
		
		//disallow them from clicking
		$('.hldr-nav-grades').click(true);
	}
	else {				
		$("#number-of-items").html(returned_items + " have synced, " + error_items + " have not synced, " + (sent_items - ( returned_items + error_items )) + " are left.");		
	}
}

function removeSuccessfullySyncd() {
	$("#gradesync-success").hide();
	$("#gradesync-success-items").empty();
	
}

function removeErrorsSyncd() {
	$("#gradesync-error").hide();
	$("#gradesync-error-description").empty();
	
}

$('#items > tbody').on('click', '.push-item-btn',
	function(event) {
		event.preventDefault();
		var item_id = $(this).data('itemid');
		push(item_id);
	}
);

$('#items > tbody').on('click', '.push-allitems-btn',
	function(event) {
	
	error_items=0;
	returned_items=0;
	sent_items=$(".chkbox-grade-item:checked").length;

	if (sent_items>0) { 		//second, reset the cursor
		$("body").css("cursor", "progress");
		//disallow them from clicking
		$('.hldr-nav-grades').click(false);
	}	
	
	removeErrorsSyncd();
	removeSuccessfullySyncd();
	

	
		event.preventDefault();
		$(".push-item-btn").each(
			function () {
				var item_id = $(this).data('itemid');
				push(item_id);
			}
		);
	}
);

$('.push-allitems-btn').click(
	function(event) {
		error_items=0;
		returned_items=0;
		sent_items=$(".chkbox-grade-item:checked").length;
		
		if (sent_items>0) { 		//second, reset the cursor
			$("body").css("cursor", "progress");
			//disallow them from clicking
			$('.hldr-nav-grades').click(false);
		}
		
		removeErrorsSyncd();
		removeSuccessfullySyncd();

		event.preventDefault();

		$(".chkbox-grade-item:checked").each(
			function () {
				var item_id = $(this).data('itemid');
				push(item_id);
			}
		);			
	}
);

/*
 TPLMS-3532
Auto grade sync Yes or No
*/
var dataItems = [];
	$('input[type="radio"]').click(function()
	{
		if ($(this).is(':checked'))
		{
			var gradeStatus = $('input[name=grades]').filter(':checked').val();
			var postObject = {"gradeStatus":gradeStatus, "isStandardCourse":isStandardCourse};
			if(gradeStatus=='Yes'){
				var sectedDataItems = [];
				$(".chkbox-grade-item:checked").each(
					function ()
					{
						var item = $(this).data('itemid');
						sectedDataItems.push(item);
					}
				)
				if (sectedDataItems == ''){
					showErrorMessage();
				}
				else{
					removeErrorsSyncd();
				}
			}
			else{
				removeErrorsSyncd();
			}
			pushMappingData(postObject);
		}
	});

/*
 TPLMS-3532
Auto grade sync enable and select each items
*/

	$(document).on('change', '.chkbox-grade-item', function() {
		if($(this).is(':checked')||!$(this).is(':checked'))
		{
			if ($('input[name=grades]').filter(':checked').val()=='Yes')
			{
				var items = [];
				var status = '';
				$(".chkbox-grade-item:checked").each
				(
					function ()
					{
						var item = $(this).data('itemid');
						items.push(item);
					}
				);


				if($(this).is(':checked')){
					removeErrorsSyncd();
				}
				else if(!$(this).is(':checked')){
					if(items==''){
						showErrorMessage();
					}
				}
				pushItems(items, status);
			}
			if ($('input[name=grades]').filter(':checked').val()=='No')
			{
				dataItems=items;
			}
		}
	});

/*
 TPLMS-3532
Auto grade sync enable and select all items
*/
	$(document).on('change', '.select-allitems-cb', function() {
		if ($(this).is(':checked')) {
			if ($('input[name=grades]').filter(':checked').val()=='Yes'){
				var status = 'All';
				var items = [];
				removeErrorsSyncd();
				pushItems(items, status);
			}
		}else{
			if ($('input[name=grades]').filter(':checked').val()=='Yes'){
				var status = '';
				var items = [];
				showErrorMessage();
				pushItems(items, status);
			}
		}
	});

/*
 TPLMS-3532
Push Mapping Data
*/
	function pushMappingData(postObject) {
		$.ajax({
			url : '/highlander/api/v1/gdc/mapping',
			type : 'POST',
			data : JSON.stringify(postObject),
			contentType : "application/json;charset=utf-8",
			success : function(response) {
				//$("#dialog-message").dialog( "success" );
			},
			error: function (xhr, ajaxOptions, thrownError) {
				//$("#dialog-message").dialog( "error" );
			}
		});
	}

/*
 TPLMS-3532
 Push item wise or All items
*/
	function pushItems(items, status) {
		$.ajax({
			url: '/highlander/api/v1/gdc/items',
			type: 'POST',
			data: JSON.stringify({items: items, status: status}),
			contentType: "application/json; charset=utf-8",
			success: function (response) {
				//$("#dialog-message").dialog( "success" );
			},
			error: function (xhr, ajaxOptions, thrownError) {
				//showErrorLabel(items);
				//$("#dialog-message").dialog( "error" );
			}
		});
	}

/*
 TPLMS-3532
 Show Error Message
 */
	function showErrorMessage(){
		removeErrorsSyncd();
		$("#gradesync-error-description").append('<p>Select assignment items to sync.</p></br>');
		$("#gradesync-error").show();
	}

// leaving these two pieces of code commented for future development
//$('.push-allitems-btn2').click(
//		function(event) {
//			event.preventDefault();
//			
//			
//			var ids = []; 
//			$(".chkbox-grade-item:checked").each(function() {
//			    ids.push("\"" + $(this).data('itemid') + "\"");
//			});
//			
//					
//			push2(ids);
//		}
//	);
//
//
//function push2(item_ids) {
//	//alert ($('.chkbox-grade-item:checked').serialize());
//	$("#dialog-message").dialog( "open" );
//	$.ajax({
//		url : '/highlander/api/v1/items2',
//		type : 'POST',
//		//data : "{'id': " + item_ids + "}",
//		data : "[" + item_ids + "]",
//		contentType : "application/json;charset=utf-8",
//		success : function(response) {
//			$("#dialog-message").dialog("close");
//			//$("#gradesync-success-items").append("<p>&nbsp;" + $("td[data-itemid='" + item_id +"']").text()+ '</p>');
//			$("#gradesync-success-items").append("<p>&nbsp;" + item_ids +'</p>');
//			$("#gradesync-success").show().delay(5000).fadeOut(removeSuccessfullySyncd);
//		},
//		error: function (xhr, ajaxOptions, thrownError) {
//			var jsonResponse = JSON.parse(xhr.responseText);
//			$("#dialog-message").dialog("close");
//			//$("#gradesync-error").append('<p>Unable to sync item: '+$("td[data-itemid='" + item_id +"']").text()+ ' <br/>&nbsp;' + jsonResponse.error + '</p></br>');
//			$("#gradesync-error").show().delay(5000).fadeOut(removeErrorsSyncd);
//		}
//	});
//}




$('.select-allitems-cb').change(
	function(event) {
		$(".chkbox-grade-item").attr("checked",$(this).is(':checked'));
	}
);
“„º¶›      X­q!X­q!=wpÂX¶«¡   O    :https://tpi.bb.pearsoncmg.com/highlander/resources/js/highlander/grades.js?v=0 necko:classified 1 strongly-framed 1 security-info FnhllAKWRHGAlo+ESXykKAAAAAAAAAAAwAAAAAAAAEaphjojH6pBabDSgSnsfLHeAAQAAgAAAAAAAAAAAAAAAAAAAAAB4vFIJp5wRkeyPxAQ9RJGKPqbqVvKO0mKuIl8ec8o/uhmCjImkVxP+7sgiYWmMt8FvcOXmlQiTNWFiWlrbpbqgwAAAAAAABBNMIIQSTCCDzGgAwIBAgIQOQxDJmqS3H9+1ztLBatN2TANBgkqhkiG9w0BAQsFADCBljELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UEBxMHU2FsZm9yZDEaMBgGA1UEChMRQ09NT0RPIENBIExpbWl0ZWQxPDA6BgNVBAMTM0NPTU9ETyBSU0EgT3JnYW5pemF0aW9uIFZhbGlkYXRpb24gU2VjdXJlIFNlcnZlciBDQTAeFw0xNjAzMjMwMDAwMDBaFw0xODAzMjMyMzU5NTlaMIGyMQswCQYDVQQGEwJHQjERMA8GA1UEERMIV0MyUiAwUkwxDzANBgNVBAgTBkxvbmRvbjEPMA0GA1UEBxMGTG9uZG9uMRQwEgYDVQQKEwtQZWFyc29uIFBMQzEgMB4GA1UECxMXSG9zdGVkIGJ5IFBlYXJzb24sIEluYy4xGTAXBgNVBAsTEE11bHRpLURvbWFpbiBTU0wxGzAZBgNVBAMTEnd3dy5wZWFyc29uY21nLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAO9ZkT6RdfiqcVJejUxhXQKSwSvO+SP7t3P1kJsyNmN2e/o0sLkBVYHpP3eq0gRa3cZQ1Qcfzy6FlcyTMRlKfv6LSEhsW1V7PSgqSNrpY4+YsqMa6c+lzshaZPzyO80TtqCcxoK5v9bQyWENdlhSzLRW6Gu9bytBERrZoCOmowUIVBxRnmBkrPMhGiNbIiv6OcZ+Y2v/ebv6dsA6qZQwhhn7XIF16Kp8jhJgEu0m4yp3efu2HV2bjK7MJjdws1LyDET1Fby7Rcl24NPQfu9RXb1XmGV9BHzErvqtvczhoTNhGc8JEfltmsPIiJV0wZfhVq4jzx0a6GXJSnRzfxpYORsCAwEAAaOCDHMwggxvMB8GA1UdIwQYMBaAFJrzK9rPrU+2L7sqSEgqErcbQsEkMB0GA1UdDgQWBBRD0N1d6T3ABcsEEzx9oi7+0fuZszAOBgNVHQ8BAf8EBAMCBaAwDAYDVR0TAQH/BAIwADAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwUAYDVR0gBEkwRzA7BgwrBgEEAbIxAQIBAwQwKzApBggrBgEFBQcCARYdaHR0cHM6Ly9zZWN1cmUuY29tb2RvLmNvbS9DUFMwCAYGZ4EMAQICMFoGA1UdHwRTMFEwT6BNoEuGSWh0dHA6Ly9jcmwuY29tb2RvY2EuY29tL0NPTU9ET1JTQU9yZ2FuaXphdGlvblZhbGlkYXRpb25TZWN1cmVTZXJ2ZXJDQS5jcmwwgYsGCCsGAQUFBwEBBH8wfTBVBggrBgEFBQcwAoZJaHR0cDovL2NydC5jb21vZG9jYS5jb20vQ09NT0RPUlNBT3JnYW5pemF0aW9uVmFsaWRhdGlvblNlY3VyZVNlcnZlckNBLmNydDAkBggrBgEFBQcwAYYYaHR0cDovL29jc3AuY29tb2RvY2EuY29tMIIKsgYDVR0RBIIKqTCCCqWCEnd3dy5wZWFyc29uY21nLmNvbYIhYXBpLnZpZXcuZWJvb2twbHVzLnBlYXJzb25jbWcuY29tggxhcmlzZXMycy5jb22CDGFyaXNlczJzLm5ldIIaYjJiLnJlZ2lzdGVyLm15cGVhcnNvbi5jb22CGmIyYy5yZWdpc3Rlci5teXBlYXJzb24uY29tgiNicmlkZ2V0b29scy5kZXZvcHMwMS5wZWFyc29uY21nLmNvbYIjYnJpZGdldG9vbHMuZGV2b3BzMDIucGVhcnNvbmNtZy5jb22CLWNkbi1odHRwLW9yaWdpbi5saXZlLm1lZGlhLnBwZS5wZWFyc29uY21nLmNvbYIXY2VydC5hcGkucGVhcnNvbmNtZy5jb22CHGNlcnQuaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CHmNlcnQubWVkaWFzaGFyZS5wZWFyc29uY21nLmNvbYIYY2VydDEucHdjLnBlYXJzb25jbWcuY29tgitjdXJyaWN1bHVtLm1lZGlhLWh0dHAtb3JpZ2luLnBlYXJzb25jbWcuY29tghZkZXYuYXBpLnBlYXJzb25jbWcuY29tghtkZXYucXVhZG5leHQucGVhcnNvbmNtZy5jb22CGmRldi5zb2Euc2d3LnBlYXJzb25jbWcuY29tghpncmFkZWl0LnBwZS5wZWFyc29uY21nLmNvbYIjaGVkLndzLm15bGFicy5weC5wcGUucGVhcnNvbmNtZy5jb22CJGhlcmVnaXN0ZXIucnVtYmEuZGVtby5wZWFyc29uY21nLmNvbYIjaGVyZWdpc3Rlci5ydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CI2hlcmVnaXN0ZXIucnVtYmEucHBlLnBlYXJzb25jbWcuY29tghppbnQuc29hLnNndy5wZWFyc29uY21nLmNvbYIXaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CI2sxMnJlcG9ydGluZy5pbnQuYXBpLnBlYXJzb25jbWcuY29tgiRrMTJyZXBvcnRpbmcudGVzdC5hcGkucGVhcnNvbmNtZy5jb22CHWxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgiBtZWRpYS1odHRwLW9yaWdpbi5wZWFyc29uY21nLmNvbYIabWVkaWFwbGF5ZXIucGVhcnNvbmNtZy5jb22CIm12Yy1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CIm12bC1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CIm12dC1tb2JpbGUucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHG15bGFicy5weC5wcGUucGVhcnNvbmNtZy5jb22CGm9ic2VydmF0aW9ucy5zY2hvb2xuZXQuY29tgiJvcGVuLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgh5wY3QuZ3JhZGVpdC5wcGUucGVhcnNvbmNtZy5jb22CGHBlYXJzb25jb3Jlc3RhbmRhcmRzLmNvbYIQcGVhcnNvbnRleGFzLmNvbYIXcGVyZi5hcGkucGVhcnNvbmNtZy5jb22CHHBlcmYuaXNiLmxpZnQucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYxLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYyLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnYzLnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY0LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY1LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CH3BlcmZlbnY2LnBlZ2FzdXMucGVhcnNvbmNtZy5jb22CEnBldC5wZWFyc29uY21nLmNvbYIfcGxheWVyLm1lZGlhLnBwZS5wZWFyc29uY21nLmNvbYIlcGxheWVyLm1lZGlhLnByb2QtdGVzdC5wZWFyc29uY21nLmNvbYIgcGxheWVyLm1lZGlhLnByb2QucGVhcnNvbmNtZy5jb22CFnBwZS5wZXQucGVhcnNvbmNtZy5jb22CFnBwZS5waWEucGVhcnNvbmNtZy5jb22CFnBwZS5wd2MucGVhcnNvbmNtZy5jb22CGnBwZS5zb2Euc2d3LnBlYXJzb25jbWcuY29tghtwcm9kLnNvYS5zZ3cucGVhcnNvbmNtZy5jb22CG3Byb3NwZXJvLmludC5wZWFyc29uY21nLmNvbYIScHdjLnBlYXJzb25jbWcuY29tghpxYS5xdWFkbmV4dC5wZWFyc29uY21nLmNvbYIUcmFkbWluLm15cGVhcnNvbi5jb22CHnJhZG1pbi5ydW1iYWRldi5wZWFyc29uY21nLmNvbYIfcmFkbWluLnJ1bWJhdGVzdC5wZWFyc29uY21nLmNvbYIWcmVnaXN0ZXIubXlwZWFyc29uLmNvbYImcmVnaXN0cmF0aW9uLnJ1bWJhLmRlbW8ucGVhcnNvbmNtZy5jb22CJXJlZ2lzdHJhdGlvbi5ydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CL3J1bWJhLWh0dHAtb3JpZ2luLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tghlydW1iYS5kZW1vLnBlYXJzb25jbWcuY29tghhydW1iYS5pbnQucGVhcnNvbmNtZy5jb22CFHJ1bWJhLnBlYXJzb25jbWcuY29tgh9zZWN1cmUucnVtYmEuaW50LnBlYXJzb25jbWcuY29tghRzaWduaW4ubXlwZWFyc29uLmNvbYIfc2ltNS5wcGUucGVnYXN1cy5wZWFyc29uY21nLmNvbYIhc21zLmxpdmUubWVkaWEucHBlLnBlYXJzb25jbWcuY29tgh1zc28ucnVtYmEuZGVtby5wZWFyc29uY21nLmNvbYIcc3NvLnJ1bWJhLmludC5wZWFyc29uY21nLmNvbYIYc3NvLnJ1bWJhLnBlYXJzb25jbWcuY29tghxzc28ucnVtYmEucHBlLnBlYXJzb25jbWcuY29tghhzdGFnZS5hcGkucGVhcnNvbmNtZy5jb22CHHN0YWdlLnNvYS5zZ3cucGVhcnNvbmNtZy5jb22CIXN0YWdpbmcubWVkaWFzaGFyZS5wZWFyc29uY21nLmNvbYIbc3RnLnF1YWRuZXh0LnBlYXJzb25jbWcuY29tghV0cGkuYmIucGVhcnNvbmNtZy5jb22CHXVzZXIucnVtYmEuaW50LnBlYXJzb25jbWcuY29tghl1c2VyLnJ1bWJhLnBlYXJzb25jbWcuY29tgh52Y2hpbGQucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHXZpZXcuZWJvb2twbHVzLnBlYXJzb25jbWcuY29tgh92aWV3LmV0ZXh0LmhvbWUyLnBlYXJzb25jbWcuY29tgh12bGlmZS5wcGUxLm12eC5wZWFyc29uY21nLmNvbYIddnRlZW4ucHBlMS5tdngucGVhcnNvbmNtZy5jb22CHHd3dy5wZWFyc29uY29yZXN0YW5kYXJkcy5jb22CFHd3dy5wZWFyc29udGV4YXMuY29tMA0GCSqGSIb3DQEBCwUAA4IBAQAtt5duenveup5NPZzyrLSw2fChmekdRvmTfdfAZF/trK54oJyKxsGI3t6CYWonfZIdE1q9cOr167wrlPEByHZImLIz+suZaNZKdHYMwp9dhnNoxqfcGkUaP5SXAE+hDe20kNAUfnvH3TEqve3DmWlBdyourD4U5GZeEgHDuEFhp25O53w9zGa5CQbAB1mnO0rXbJZ4B08EhZdQSxDC95S1MG62/HxP0CU55EQIVvjh8eSCRq4lDCyajB4YFNNmB+rI7nSAk5JWktEbwN8JNXNtv6KAMGD65T0Eoj6xUEPdTobBs9JiChQ21ctvpGyjwD8RBPAS89DX6tEMxHJMYKddAC8AAwAAAAABAQAA request-method GET response-head HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Last-Modified: Mon, 28 Nov 2016 21:10:18 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 8365
Date: Wed, 22 Feb 2017 11:08:19 GMT
 original-response-headers Server: Apache-Coyote/1.1
Last-Modified: Mon, 28 Nov 2016 21:10:18 GMT
Content-Type: application/javascript;charset=UTF-8
Content-Length: 8365
Date: Wed, 22 Feb 2017 11:08:19 GMT
 uncompressed-len 0    ­